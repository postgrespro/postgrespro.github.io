<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title></title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /></head><body><div class="book"><div class="titlepage"><hr /></div><div class="reference"><div class="titlepage"><div><div><h1 class="title"><a id="idm46529710251664"></a>pg_probackup Documentation</h1></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="refsect1"><a href="#idm46529706496864">
   Description
  </a></span></dt><dt><span class="refsect1"><a href="#pbk-overview">
   Overview
  </a></span></dt><dd><dl><dt><span class="refsect2"><a href="#pbk-limitations">Limitations</a></span></dt></dl></dd><dt><span class="refsect1"><a href="#pbk-install-and-setup">Installation and Setup</a></span></dt><dd><dl><dt><span class="refsect2"><a href="#pbk-initializing-the-backup-catalog">Initializing the Backup Catalog</a></span></dt><dt><span class="refsect2"><a href="#pbk-adding-new-backup-instance">Adding a New Backup Instance</a></span></dt><dt><span class="refsect2"><a href="#pbk-configuring-the-database-cluster">Configuring the Database Cluster</a></span></dt><dt><span class="refsect2"><a href="#pbk-setting-up-stream-backups">Setting up STREAM Backups</a></span></dt><dt><span class="refsect2"><a href="#pbk-setting-up-continuous-wal-archiving">Setting up Continuous WAL Archiving</a></span></dt><dt><span class="refsect2"><a href="#pbk-setting-up-backup-from-standby">Setting up Backup from Standby</a></span></dt><dt><span class="refsect2"><a href="#pbk-setting-up-cluster-verification">Setting up Cluster Verification</a></span></dt><dt><span class="refsect2"><a href="#pbk-setting-up-partial-restore">Setting up Partial Restore</a></span></dt><dt><span class="refsect2"><a href="#pbk-configuring-the-remote-mode">Configuring the Remote Mode</a></span></dt><dd><dl><dt><span class="refsect3"><a href="#pbk-setup-ssh">Set up SSH</a></span></dt></dl></dd><dt><span class="refsect2"><a href="#pbk-setting-up-ptrack-backups">Setting up PTRACK Backups</a></span></dt></dl></dd><dt><span class="refsect1"><a href="#pbk-usage">Usage</a></span></dt><dd><dl><dt><span class="refsect2"><a href="#pbk-creating-backup">Creating a Backup</a></span></dt><dd><dl><dt><span class="refsect3"><a href="#pbk-archive-mode">ARCHIVE Mode</a></span></dt><dt><span class="refsect3"><a href="#pbk-stream-mode">STREAM Mode</a></span></dt><dt><span class="refsect3"><a href="#pbk-page-validation">Page Validation</a></span></dt><dt><span class="refsect3"><a href="#pbk-external-directories">External Directories</a></span></dt></dl></dd><dt><span class="refsect2"><a href="#pbk-verifying-a-cluster">Performing Cluster Verification</a></span></dt><dt><span class="refsect2"><a href="#pbk-validating-backups">Validating a Backup</a></span></dt><dt><span class="refsect2"><a href="#pbk-restoring-a-cluster">Restoring a Cluster</a></span></dt><dd><dl><dt><span class="refsect3"><a href="#pbk-partial-restore">Partial Restore</a></span></dt></dl></dd><dt><span class="refsect2"><a href="#pbk-performing-point-in-time-pitr-recovery">Performing Point-in-Time (PITR) Recovery</a></span></dt><dt><span class="refsect2"><a href="#pbk-remote-backup">Using <span class="application">pg_probackup</span> in the Remote Mode</a></span></dt><dt><span class="refsect2"><a href="#pbk-running-pg-probackup-on-parallel-threads">Running <span class="application">pg_probackup</span> on Parallel Threads</a></span></dt><dt><span class="refsect2"><a href="#pbk-configuring-pg-probackup">Configuring <span class="application">pg_probackup</span></a></span></dt><dt><span class="refsect2"><a href="#pbk-specifying-connection-settings">Specifying Connection Settings</a></span></dt><dt><span class="refsect2"><a href="#pbk-managing-the-backup-catalog">Managing the Backup Catalog</a></span></dt><dd><dl><dt><span class="refsect3"><a href="#pbk-viewing-backup-info">Viewing Backup Information</a></span></dt><dt><span class="refsect3"><a href="#pbk-viewing-wal-archive-information">Viewing WAL Archive Information</a></span></dt></dl></dd><dt><span class="refsect2"><a href="#pbk-configuring-retention-policy">Configuring Retention Policy</a></span></dt><dd><dl><dt><span class="refsect3"><a href="#pbk-retention-policy">Removing Redundant Backups</a></span></dt><dt><span class="refsect3"><a href="#pbk-backup-pinning">Pinning Backups</a></span></dt><dt><span class="refsect3"><a href="#pbk-wal-archive-retention-policy">Configuring WAL Archive Retention Policy</a></span></dt></dl></dd><dt><span class="refsect2"><a href="#pbk-merging-backups">Merging Backups</a></span></dt><dt><span class="refsect2"><a href="#pbk-deleting-backups">Deleting Backups</a></span></dt></dl></dd><dt><span class="refsect1"><a href="#pbk-reference">Command-Line Reference</a></span></dt><dd><dl><dt><span class="refsect2"><a href="#pbk-commands">Commands</a></span></dt><dd><dl><dt><span class="refsect3"><a href="#pbk-version">version</a></span></dt><dt><span class="refsect3"><a href="#pbk-help">help</a></span></dt><dt><span class="refsect3"><a href="#pbk-init">init</a></span></dt><dt><span class="refsect3"><a href="#pbk-add-instance">add-instance</a></span></dt><dt><span class="refsect3"><a href="#pbk-del-instance">del-instance</a></span></dt><dt><span class="refsect3"><a href="#pbk-set-config">set-config</a></span></dt><dt><span class="refsect3"><a href="#pbk-set-backup">set-backup</a></span></dt><dt><span class="refsect3"><a href="#pbk-show-config">show-config</a></span></dt><dt><span class="refsect3"><a href="#pbk-show">show</a></span></dt><dt><span class="refsect3"><a href="#pbk-backup">backup</a></span></dt><dt><span class="refsect3"><a href="#pbk-restore">restore</a></span></dt><dt><span class="refsect3"><a href="#pbk-checkdb">checkdb</a></span></dt><dt><span class="refsect3"><a href="#pbk-validate">validate</a></span></dt><dt><span class="refsect3"><a href="#pbk-merge">merge</a></span></dt><dt><span class="refsect3"><a href="#pbk-delete">delete</a></span></dt><dt><span class="refsect3"><a href="#pbk-archive-push">archive-push</a></span></dt><dt><span class="refsect3"><a href="#pbk-archive-get">archive-get</a></span></dt></dl></dd><dt><span class="refsect2"><a href="#pbk-options">Options</a></span></dt><dd><dl><dt><span class="refsect3"><a href="#pbk-common-options">Common Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-recovery-target-opts">Recovery Target Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-retention-opts">Retention Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-pinning-options">Pinning Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-logging-opts">Logging Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-connection-opts">Connection Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-compression-opts">Compression Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-archiving-options">Archiving Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-remote-server-opts">Remote Mode Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-remote-wal-archive-options">Remote WAL Archive Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-partial-restore-options">Partial Restore Options</a></span></dt><dt><span class="refsect3"><a href="#pbk-replica-options">Replica Options</a></span></dt></dl></dd></dl></dd><dt><span class="refsect1"><a href="#pbk-howto">How-To</a></span></dt><dd><dl><dt><span class="refsect2"><a href="#pbk-minimal-setup">Minimal Setup</a></span></dt></dl></dd><dt><span class="refsect1"><a href="#pbk-versioning">Versioning</a></span></dt><dt><span class="refsect1"><a href="#idm46529704971520">Authors</a></span></dt><dd><dl><dt><span class="refsect2"><a href="#idm46529704970400">Credits</a></span></dt></dl></dd></dl></div><div class="refentry"><a id="app-pgprobackup"></a><div class="titlepage"></div><a id="idm46529711473536" class="indexterm"></a><div class="refnamediv"><h2>Name</h2><p>pg_probackup — manage backup and recovery of <span class="productname">PostgreSQL</span> database clusters</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">version</code> </p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">help</code>  [<em class="replaceable"><code>command</code></em>]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">init</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em> </p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">add-instance</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">-D</code> <em class="replaceable"><code>data_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em> </p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">del-instance</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em> </p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">set-config</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">set-backup</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>   <code class="option">-i</code> <em class="replaceable"><code>backup_id</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">show-config</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>  [<code class="option">--format=<em class="replaceable"><code>format</code></em></code>]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">show</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">backup</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>   <code class="option">-b</code> <em class="replaceable"><code>backup_mode</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">restore</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">checkdb</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>   <code class="option">-D</code> <em class="replaceable"><code>data_dir</code></em>  [<code class="option">option</code>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">validate</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">merge</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>   <code class="option">-i</code> <em class="replaceable"><code>backup_id</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">delete</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>  { <code class="option">-i</code> <em class="replaceable"><code>backup_id</code></em>  |   <code class="option">--delete-wal</code>  |   <code class="option">--delete-expired</code>  |   <code class="option">--merge-expired</code> } [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">archive-push</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>   <code class="option">--wal-file-name</code> <em class="replaceable"><code>wal_file_name</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div><div class="cmdsynopsis"><p><code class="command">pg_probackup</code>   <code class="option">archive-get</code>   <code class="option">-B</code> <em class="replaceable"><code>backup_dir</code></em>   <code class="option">--instance</code> <em class="replaceable"><code>instance_name</code></em>   <code class="option">--wal-file-path</code> <em class="replaceable"><code>wal_file_path</code></em>   <code class="option">--wal-file-name</code> <em class="replaceable"><code>wal_file_name</code></em>  [<em class="replaceable"><code>option</code></em>...]</p></div></div><div class="refsect1"><a id="idm46529706496864"></a><h2>
   Description
  </h2><p>
   <span class="application">pg_probackup</span> is a utility to manage backup and
   recovery of <span class="productname">PostgreSQL</span> database clusters.
   It is designed to perform periodic backups of the <span class="productname">PostgreSQL</span> 
   instance that enable you to restore the server in case of a failure.
   <span class="application">pg_probackup</span> supports <span class="productname">PostgreSQL</span> 9.5 or higher.
  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="#pbk-overview" title="Overview">Overview</a></p></li><li class="listitem"><p><a class="link" href="#pbk-install-and-setup" title="Installation and Setup">Installation and Setup</a></p></li><li class="listitem"><p><a class="link" href="#pbk-reference" title="Command-Line Reference">Command-Line Reference</a></p></li><li class="listitem"><p><a class="link" href="#pbk-usage" title="Usage">Usage</a></p></li></ul></div></div><div class="refsect1"><a id="pbk-overview"></a><h2>
   Overview
  </h2><p>
   As compared to other backup solutions, <span class="application">pg_probackup</span> offers the
   following benefits that can help you implement different backup
   strategies and deal with large amounts of data:
  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Incremental backup: with three different incremental modes,
        you can plan the backup strategy in accordance with your data flow.
        Incremental backups allow you to save disk space
        and speed up backup as compared to taking full backups.
        It is also faster to restore the cluster by applying incremental
        backups than by replaying WAL files.
      </p></li><li class="listitem"><p>
        Validation: automatic data consistency checks and on-demand
        backup validation without actual data recovery.
      </p></li><li class="listitem"><p>
        Verification: on-demand verification of <span class="productname">PostgreSQL</span> instance
        with the <span class="command"><strong>checkdb</strong></span> command.
      </p></li><li class="listitem"><p>
        Retention: managing WAL archive and backups in accordance with
        retention policy. You can configure retention policy based on recovery time
        or the number of backups to keep, as well as specify time to live (TTL)
        for a particular backup. Expired backups can be merged or deleted.
      </p></li><li class="listitem"><p>
        Parallelization: running <span class="command"><strong>backup</strong></span>,
        <span class="command"><strong>restore</strong></span>, <span class="command"><strong>merge</strong></span>,
        <span class="command"><strong>delete</strong></span>, <span class="command"><strong>validate</strong></span>,
        and <span class="command"><strong>checkdb</strong></span> processes on multiple parallel threads.
      </p></li><li class="listitem"><p>
        Compression: storing backup data in a compressed state to save
        disk space.
      </p></li><li class="listitem"><p>
        Deduplication: saving disk space by excluding non-data
        files (such as <code class="literal">_vm</code> or <code class="literal">_fsm</code>)
        from incremental backups if these files have not changed since
        they were copied into one of the previous backups in this incremental chain.
      </p></li><li class="listitem"><p>
        Remote operations: backing up <span class="productname">PostgreSQL</span>
        instance located on a remote system or restoring a backup remotely.
      </p></li><li class="listitem"><p>
        Backup from standby: avoiding extra load on master by
        taking backups from a standby server.
      </p></li><li class="listitem"><p>
        External directories: backing up files and directories
        located outside of the <span class="productname">PostgreSQL</span> data
        directory (<code class="envar">PGDATA</code>), such as scripts, configuration
        files, logs, or SQL dump files.
      </p></li><li class="listitem"><p>
        Backup catalog: getting the list of backups and the corresponding meta
        information in plain text or
        <acronym class="acronym">JSON</acronym> formats.
      </p></li><li class="listitem"><p>
        Archive catalog: getting the list of all WAL timelines and
        the corresponding meta information in plain text or
        <acronym class="acronym">JSON</acronym> formats.
      </p></li><li class="listitem"><p>
        Partial restore: restoring only the specified databases.
      </p></li></ul></div><p>
    To manage backup data, <span class="application">pg_probackup</span> creates a
    <em class="firstterm">backup catalog</em>. This is a directory that stores
    all backup files with additional meta information, as well as WAL
    archives required for point-in-time recovery. You can store
    backups for different instances in separate subdirectories of a
    single backup catalog.
  </p><p>
    Using <span class="application">pg_probackup</span>, you can take full or incremental
    <a class="link" href="#pbk-creating-backup" title="Creating a Backup">backups</a>:
  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        FULL backups contain all the data files required to restore
        the database cluster.
      </p></li><li class="listitem"><p>
        Incremental backups operate at the page level, only storing the data that has changed since
        the previous backup. It allows you to save disk space
        and speed up the backup process as compared to taking full backups.
        It is also faster to restore the cluster by applying incremental
        backups than by replaying WAL files. <span class="application">pg_probackup</span> supports
        the following modes of incremental backups:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
            DELTA backup. In this mode, <span class="application">pg_probackup</span> reads all data
            files in the data directory and copies only those pages
            that have changed since the previous backup. This
            mode can impose read-only I/O pressure equal to a full
            backup.
          </p></li><li class="listitem"><p>
            PAGE backup. In this mode, <span class="application">pg_probackup</span> scans all WAL
            files in the archive from the moment the previous full or
            incremental backup was taken. Newly created backups
            contain only the pages that were mentioned in WAL records.
            This requires all the WAL files since the previous backup
            to be present in the WAL archive. If the size of these
            files is comparable to the total size of the database
            cluster files, speedup is smaller, but the backup still
            takes less space. You have to configure WAL archiving as
            explained in <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">Setting
            up continuous WAL archiving</a> to make PAGE backups.
          </p></li><li class="listitem"><p>
            PTRACK backup. In this mode, <span class="productname">PostgreSQL</span> tracks page
            changes on the fly. Continuous archiving is not necessary
            for it to operate. Each time a relation page is updated,
            this page is marked in a special PTRACK bitmap. Tracking implies some
            minor overhead on the database server operation, but
            speeds up incremental backups significantly.
          </p></li></ul></div></li></ul></div><p>
    <span class="application">pg_probackup</span> can take only physical online backups, and online
    backups require WAL for consistent recovery. So regardless of the
    chosen backup mode (FULL, PAGE or DELTA), any backup taken with
    <span class="application">pg_probackup</span> must use one of the following
    <em class="firstterm">WAL delivery modes</em>:
  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="#pbk-archive-mode" title="ARCHIVE Mode">ARCHIVE</a>. Such backups rely
        on
        <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
        archiving</a> to ensure consistent recovery. This is the
        default WAL delivery mode.
      </p></li><li class="listitem"><p>
        <a class="link" href="#pbk-stream-mode" title="STREAM Mode">STREAM</a>. Such backups
        include all the files required to restore the cluster to a
        consistent state at the time the backup was taken. Regardless
        of
        <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
        archiving</a> having been set up or not, the WAL segments required
        for consistent recovery are streamed via
        replication protocol during backup and included into the
        backup files. That's why such backups are called
        <em class="firstterm">autonomous</em>, or <em class="firstterm">standalone</em>.
      </p></li></ul></div><div class="refsect2"><a id="pbk-limitations"></a><h3>Limitations</h3><p>
    <span class="application">pg_probackup</span> currently has the following limitations:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="application">pg_probackup</span> only supports <span class="productname">PostgreSQL</span>  9.5 and higher.
        </p></li><li class="listitem"><p>
          The remote mode is not supported on Windows systems.
        </p></li><li class="listitem"><p>
          On Unix systems, for <span class="productname">PostgreSQL</span> 10 or higher,
          a backup can be made only by the same OS user that has started the <span class="productname">PostgreSQL</span>
          server. For example, if <span class="productname">PostgreSQL</span> server is started by
          user <code class="literal">postgres</code>, the <code class="literal">backup</code> command must also be run
          by user <code class="literal">postgres</code>. To satisfy this requirement when taking backups in the
          <a class="link" href="#pbk-remote-backup" title="Using pg_probackup in the Remote Mode">remote mode</a> using SSH, you must set
          <code class="option">--remote-user</code> option to <code class="literal">postgres</code>.
        </p></li><li class="listitem"><p>
          For PostgreSQL 9.5, functions
          <code class="function">pg_create_restore_point(text)</code> and
          <code class="function">pg_switch_xlog()</code> can be executed only if
          the backup role is a superuser, so backup of a
          cluster with low amount of WAL traffic by a non-superuser
          role can take longer than the backup of the same cluster by
          a superuser role.
        </p></li><li class="listitem"><p>
          The <span class="productname">PostgreSQL</span> server from which the backup was taken and
          the restored server must be compatible by the
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-preset.html#GUC-BLOCK-SIZE" target="_top">block_size</a>
          and
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-preset.html#GUC-WAL-BLOCK-SIZE" target="_top">wal_block_size</a>
          parameters and have the same major release number.
          Depending on cluster configuration, <span class="productname">PostgreSQL</span> itself may
          apply additional restrictions, such as CPU architecture
          or <span class="application">libc</span>/<span class="application">libicu</span> versions.
        </p></li></ul></div><p>
  </p></div></div><div class="refsect1"><a id="pbk-install-and-setup"></a><h2>Installation and Setup</h2><p>
    Once you have <span class="application">pg_probackup</span> installed, complete the following
    setup:
  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Initialize the backup catalog.
      </p></li><li class="listitem"><p>
        Add a new backup instance to the backup catalog.
      </p></li><li class="listitem"><p>
        Configure the database cluster to enable <span class="application">pg_probackup</span> backups.
      </p></li><li class="listitem"><p>
        Optionally, configure SSH for running <span class="application">pg_probackup</span> operations
        in the remote mode.
      </p></li></ul></div><div class="refsect2"><a id="pbk-initializing-the-backup-catalog"></a><h3>Initializing the Backup Catalog</h3><p>
      <span class="application">pg_probackup</span> stores all WAL and backup files in the
      corresponding subdirectories of the backup catalog.
    </p><p>
      To initialize the backup catalog, run the following command:
    </p><pre class="programlisting">
pg_probackup init -B <em class="replaceable"><code>backup_dir</code></em>
</pre><p>
      where <em class="replaceable"><code>backup_dir</code></em> is the path to the backup
      catalog. If the <em class="replaceable"><code>backup_dir</code></em> already exists,
      it must be empty. Otherwise, <span class="application">pg_probackup</span> returns an error.
    </p><p>
      The user launching <span class="application">pg_probackup</span> must have full access to
      the <em class="replaceable"><code>backup_dir</code></em> directory.
    </p><p>
      <span class="application">pg_probackup</span> creates the <em class="replaceable"><code>backup_dir</code></em> backup
      catalog, with the following subdirectories:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="filename">wal/</code> — directory for WAL files.
        </p></li><li class="listitem"><p>
          <code class="filename">backups/</code> — directory for backup files.
        </p></li></ul></div><p>
      Once the backup catalog is initialized, you can add a new backup
      instance.
    </p></div><div class="refsect2"><a id="pbk-adding-new-backup-instance"></a><h3>Adding a New Backup Instance</h3><p>
      <span class="application">pg_probackup</span> can store backups for multiple database clusters in
      a single backup catalog. To set up the required subdirectories,
      you must add a backup instance to the backup catalog for each
      database cluster you are going to back up.
    </p><p>
      To add a new backup instance, run the following command:
    </p><pre class="programlisting">
pg_probackup add-instance -B <em class="replaceable"><code>backup_dir</code></em> -D <em class="replaceable"><code>data_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> [<em class="replaceable"><code>remote_options</code></em>]
</pre><p>
      where:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <em class="replaceable"><code>data_dir</code></em> is the data directory of the
          cluster you are going to back up. To set up and use
          <span class="application">pg_probackup</span>, write access to this directory is required.
        </p></li><li class="listitem"><p>
          <em class="replaceable"><code>instance_name</code></em> is the name of the
          subdirectories that will store WAL and backup files for this
          cluster.
        </p></li><li class="listitem"><p>
          <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote_options</a>
          are optional parameters that need to be specified only if
          <em class="replaceable"><code>data_dir</code></em> is located
          on a remote system.
        </p></li></ul></div><p>
      <span class="application">pg_probackup</span> creates the <em class="replaceable"><code>instance_name</code></em>
      subdirectories under the <code class="filename">backups/</code> and <code class="filename">wal/</code> directories of
      the backup catalog. The
      <code class="filename">backups/<em class="replaceable"><code>instance_name</code></em></code> directory contains
      the <code class="filename">pg_probackup.conf</code> configuration file that controls
      <span class="application">pg_probackup</span> settings for this backup instance. If you run this
      command with the
      <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote_options</a>, the specified
      parameters will be added to <code class="filename">pg_probackup.conf</code>.
    </p><p>
      For details on how to fine-tune <span class="application">pg_probackup</span> configuration, see
      <a class="xref" href="#pbk-configuring-pg-probackup" title="Configuring pg_probackup">the section called “Configuring <span class="application">pg_probackup</span>”</a>.
    </p><p>
      The user launching <span class="application">pg_probackup</span> must have full access to
      <em class="replaceable"><code>backup_dir</code></em> directory and at least read-only
      access to <em class="replaceable"><code>data_dir</code></em> directory. If you
      specify the path to the backup catalog in the
      <code class="envar">BACKUP_PATH</code> environment variable, you can
      omit the corresponding option when running <span class="application">pg_probackup</span>
      commands.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        For <span class="productname">PostgreSQL</span> 11 or higher, it is recommended to use the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/app-initdb.html#APP-INITDB-ALLOW-GROUP-ACCESS" target="_top">allow-group-access</a>
        feature, so that backup can be done by any OS user in the same
        group as the cluster owner. In this case, the user should have
        read permissions for the cluster directory.
      </p></div></div><div class="refsect2"><a id="pbk-configuring-the-database-cluster"></a><h3>Configuring the Database Cluster</h3><p>
      Although <span class="application">pg_probackup</span> can be used by a superuser, it is
      recommended to create a separate role with the minimum
      permissions required for the chosen backup strategy. In these
      configuration instructions, the <code class="literal">backup</code> role
      is used as an example.
    </p><p>
      To perform a <a class="xref" href="#pbk-backup" title="backup">backup</a>, the following
      permissions for role <code class="literal">backup</code> are required
      only in the database <span class="strong"><strong>used for
      connection</strong></span> to the <span class="productname">PostgreSQL</span> server:
    </p><p>
      For PostgreSQL 9.5:
    </p><pre class="programlisting">
BEGIN;
CREATE ROLE backup WITH LOGIN;
GRANT USAGE ON SCHEMA pg_catalog TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.current_setting(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_is_in_recovery() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_start_backup(text, boolean) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_stop_backup() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_create_restore_point(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_switch_xlog() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current_snapshot() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_snapshot_xmax(txid_snapshot) TO backup;
COMMIT;
</pre><p>
      For <span class="productname">PostgreSQL</span> 9.6:
    </p><pre class="programlisting">
BEGIN;
CREATE ROLE backup WITH LOGIN;
GRANT USAGE ON SCHEMA pg_catalog TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.current_setting(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_is_in_recovery() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_start_backup(text, boolean, boolean) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_stop_backup(boolean) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_create_restore_point(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_switch_xlog() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_last_xlog_replay_location() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current_snapshot() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_snapshot_xmax(txid_snapshot) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_control_checkpoint() TO backup;
COMMIT;
</pre><p>
      For <span class="productname">PostgreSQL</span> 10 or higher:
    </p><pre class="programlisting">
BEGIN;
CREATE ROLE backup WITH LOGIN;
GRANT USAGE ON SCHEMA pg_catalog TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.current_setting(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_is_in_recovery() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_start_backup(text, boolean, boolean) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_stop_backup(boolean, boolean) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_create_restore_point(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_switch_wal() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_last_wal_replay_lsn() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current_snapshot() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_snapshot_xmax(txid_snapshot) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_control_checkpoint() TO backup;
COMMIT;
</pre><p>
      In the
      <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/auth-pg-hba-conf.html" target="_top">pg_hba.conf</a>
      file, allow connection to the database cluster on behalf of the
      <code class="literal">backup</code> role.
    </p><p>
      Since <span class="application">pg_probackup</span> needs to read cluster files directly,
      <span class="application">pg_probackup</span> must be started by (or connected to,
      if used in the remote mode) the OS user that has read access to all files and
      directories inside the data directory (<code class="envar">PGDATA</code>) you are going to
      back up.
    </p><p>
      Depending on whether you plan to take
      <a class="link" href="#pbk-stream-mode" title="STREAM Mode">standalone</a> or
      <a class="link" href="#pbk-archive-mode" title="ARCHIVE Mode">archive</a> backups, <span class="productname">PostgreSQL</span>
      cluster configuration will differ, as specified in the sections
      below. To back up the database cluster from a standby server,
      run <span class="application">pg_probackup</span> in the remote mode, or create PTRACK backups,
      additional setup is required.
    </p><p>
      For details, see the sections
      <a class="link" href="#pbk-setting-up-stream-backups" title="Setting up STREAM Backups">Setting up STREAM
      Backups</a>,
      <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">Setting up
      continuous WAL archiving</a>,
      <a class="link" href="#pbk-setting-up-backup-from-standby" title="Setting up Backup from Standby">Setting up Backup
      from Standby</a>,
      <a class="link" href="#pbk-configuring-the-remote-mode" title="Configuring the Remote Mode">Configuring the
      Remote Mode</a>,
      <a class="link" href="#pbk-setting-up-partial-restore" title="Setting up Partial Restore">Setting up Partial
      Restore</a>, and
      <a class="link" href="#pbk-setting-up-ptrack-backups" title="Setting up PTRACK Backups">Setting up PTRACK
      Backups</a>.
    </p></div><div class="refsect2"><a id="pbk-setting-up-stream-backups"></a><h3>Setting up STREAM Backups</h3><p>
      To set up the cluster for
      <a class="link" href="#pbk-stream-mode" title="STREAM Mode">STREAM</a> backups, complete the
      following steps:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Grant the <code class="literal">REPLICATION</code> privilege to the <code class="literal">backup</code> role:
        </p><pre class="programlisting">
ALTER ROLE backup WITH REPLICATION;
</pre></li><li class="listitem"><p>
          In the
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/auth-pg-hba-conf.html" target="_top">pg_hba.conf</a>
          file, allow replication on behalf of the
          <code class="literal">backup</code> role.
        </p></li><li class="listitem"><p>
          Make sure the parameter
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-replication.html#GUC-MAX-WAL-SENDERS" target="_top">max_wal_senders</a>
          is set high enough to leave at least one session available
          for the backup process.
        </p></li><li class="listitem"><p>
          Set the parameter
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-WAL-LEVEL" target="_top">wal_level</a>
          to be higher than <code class="literal">minimal</code>.
        </p></li></ul></div><p>
      If you are planning to take PAGE backups in the STREAM mode or
      perform PITR with STREAM backups, you still have to configure
      WAL archiving, as explained in the section
      <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">Setting up
      continuous WAL archiving</a>.
    </p><p>
      Once these steps are complete, you can start taking FULL, PAGE,
      DELTA, and PTRACK backups in the
      <a class="link" href="#pbk-stream-mode" title="STREAM Mode">STREAM</a> WAL mode.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        If you are planning to rely on
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/libpq-pgpass.html" target="_top">.pgpass</a>
        for authentication when running backup in STREAM mode,
        then .pgpass must contain credentials for <code class="literal">replication</code> database,
        used to establish connection via replication protocol. Example:
        pghost:5432:replication:backup_user:my_strong_password
      </p></div></div><div class="refsect2"><a id="pbk-setting-up-continuous-wal-archiving"></a><h3>Setting up Continuous WAL Archiving</h3><p>
      Making backups in PAGE backup mode, performing
      <a class="link" href="#pbk-performing-point-in-time-pitr-recovery" title="Performing Point-in-Time (PITR) Recovery">PITR</a>,
      making backups with
      <a class="link" href="#pbk-archive-mode" title="ARCHIVE Mode">ARCHIVE</a> WAL delivery mode and
      running incremental backup after timeline switch
      require
      <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/continuous-archiving.html" target="_top">continuous
      WAL archiving</a> to be enabled. To set up continuous
      archiving in the cluster, complete the following steps:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Make sure the
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-WAL-LEVEL" target="_top">wal_level</a>
          parameter is higher than <code class="literal">minimal</code>.
        </p></li><li class="listitem"><p>
          If you are configuring archiving on master,
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-ARCHIVE-MODE" target="_top">archive_mode</a>
          must be set to <code class="literal">on</code> or
          <code class="literal">always</code>. To perform archiving on standby,
          set this parameter to <code class="literal">always</code>.
        </p></li><li class="listitem"><p>
          Set the
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-ARCHIVE-COMMAND" target="_top">archive_command</a>
          parameter, as follows:
        </p><pre class="programlisting">
archive_command = '<em class="replaceable"><code>install_dir</code></em>/pg_probackup archive-push -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --wal-file-name=%f [<em class="replaceable"><code>remote_options</code></em>]'
</pre></li></ul></div><p>
      where <em class="replaceable"><code>install_dir</code></em> is the
      installation directory of the <span class="application">pg_probackup</span>
      version you are going to use, <em class="replaceable"><code>backup_dir</code></em> and
      <em class="replaceable"><code>instance_name</code></em> refer to the already
      initialized backup catalog instance for this database cluster,
      and <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote_options</a>
      only need to be specified to archive WAL on a remote host. For details about all
      possible <span class="command"><strong>archive-push</strong></span> parameters, see the
      section <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a>.
    </p><p>
      Once these steps are complete, you can start making backups in the
      <a class="link" href="#pbk-archive-mode" title="ARCHIVE Mode">ARCHIVE</a> WAL mode, backups in
      the PAGE backup mode, as well as perform
      <a class="link" href="#pbk-performing-point-in-time-pitr-recovery" title="Performing Point-in-Time (PITR) Recovery">PITR</a>.
    </p><p>
      You can view the current state of the WAL archive using the
      <a class="xref" href="#pbk-show" title="show">show</a> command. For details, see
      <a class="xref" href="#pbk-viewing-wal-archive-information" title="Viewing WAL Archive Information">the section called “Viewing WAL Archive Information”</a>.
    </p><p>
      If you are planning to make PAGE backups and/or backups with
      <a class="link" href="#pbk-archive-mode" title="ARCHIVE Mode">ARCHIVE</a> WAL mode from a
      standby server that generates a small amount of WAL traffic,
      without long waiting for WAL segment to fill up, consider
      setting the
      <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-ARCHIVE-TIMEOUT" target="_top">archive_timeout</a>
      <span class="productname">PostgreSQL</span> parameter <span class="strong"><strong>on
      master</strong></span>. The value of this parameter should be slightly
      lower than the <code class="option">--archive-timeout</code> setting (5 minutes by default),
      so that there is enough time for the rotated
      segment to be streamed to standby and sent to WAL archive before the
      backup is aborted because of <code class="option">--archive-timeout</code>.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        Instead of using the <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a>
        command provided by <span class="application">pg_probackup</span>, you can use
        any other tool to set up continuous archiving as long as it delivers WAL segments into
        <code class="filename"><em class="replaceable"><code>backup_dir</code></em>/wal/<em class="replaceable"><code>instance_name</code></em></code>
        directory. If compression is used, it should be
        <code class="literal">gzip</code>, and <code class="literal">.gz</code> suffix in filename is
        mandatory.
      </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        Instead of configuring continuous archiving by setting the
        <code class="varname">archive_mode</code> and <code class="varname">archive_command</code>
        parameters, you can opt for using the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/app-pgreceivewal.html" target="_top">pg_receivewal</a>
        utility. In this case, <span class="application">pg_receivewal</span> <code class="literal">-D <em class="replaceable"><code>directory</code></em></code>
        option should point to
        <code class="filename"><em class="replaceable"><code>backup_dir</code></em>/wal/<em class="replaceable"><code>instance_name</code></em></code>
        directory. <span class="application">pg_probackup</span> supports WAL compression
        that can be done by <span class="application">pg_receivewal</span>.
        <span class="quote">“<span class="quote">Zero Data Loss</span>”</span> archive strategy can be
        achieved only by using <span class="application">pg_receivewal</span>.
      </p></div></div><div class="refsect2"><a id="pbk-setting-up-backup-from-standby"></a><h3>Setting up Backup from Standby</h3><p>
      For <span class="productname">PostgreSQL</span> 9.6 or higher, <span class="application">pg_probackup</span> can take backups from
      a standby server. This requires the following additional setup:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          On the standby server, set the
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-replication.html#GUC-HOT-STANDBY" target="_top">hot_standby</a>
          parameter to <code class="literal">on</code>.
        </p></li><li class="listitem"><p>
          On the master server, set the
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-FULL-PAGE-WRITES" target="_top">full_page_writes</a>
          parameter to <code class="literal">on</code>.
        </p></li><li class="listitem"><p>
          To perform standalone backups on standby, complete all steps
          in section <a class="link" href="#pbk-setting-up-stream-backups" title="Setting up STREAM Backups">Setting
          up STREAM Backups</a>.
        </p></li><li class="listitem"><p>
          To perform archive backups on standby, complete all steps in
          section
          <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">Setting
          up continuous WAL archiving</a>.
        </p></li></ul></div><p>
      Once these steps are complete, you can start taking FULL, PAGE,
      DELTA, or PTRACK backups with appropriate WAL delivery mode:
      ARCHIVE or STREAM, from the standby server.
    </p><p>
      Backup from the standby server has the following limitations:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          If the standby is promoted to the master during backup, the
          backup fails.
        </p></li><li class="listitem"><p>
          All WAL records required for the backup must contain
          sufficient full-page writes. This requires you to enable
          <code class="literal">full_page_writes</code> on the master, and not
          to use tools like <span class="application">pg_compresslog</span> as
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-ARCHIVE-COMMAND" target="_top">archive_command</a>
          to remove full-page writes from WAL files.
        </p></li></ul></div></div><div class="refsect2"><a id="pbk-setting-up-cluster-verification"></a><h3>Setting up Cluster Verification</h3><p>
      Logical verification of a database cluster requires the following
      additional setup. Role <code class="literal">backup</code> is used as an
      example:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Install the
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/amcheck.html" target="_top">amcheck</a>
          or
          <a class="ulink" href="https://github.com/petergeoghegan/amcheck" target="_top">amcheck_next</a> extension
          <span class="strong"><strong>in every database</strong></span> of the
          cluster:
        </p><pre class="programlisting">
CREATE EXTENSION amcheck;
</pre></li><li class="listitem"><p>
          Grant the following permissions to the <code class="literal">backup</code>
          role <span class="strong"><strong>in every database</strong></span> of the cluster:
        </p></li></ul></div><pre class="programlisting">
GRANT SELECT ON TABLE pg_catalog.pg_am TO backup;
GRANT SELECT ON TABLE pg_catalog.pg_class TO backup;
GRANT SELECT ON TABLE pg_catalog.pg_database TO backup;
GRANT SELECT ON TABLE pg_catalog.pg_namespace TO backup;
GRANT SELECT ON TABLE pg_catalog.pg_extension TO backup;
GRANT EXECUTE ON FUNCTION bt_index_check(regclass) TO backup;
GRANT EXECUTE ON FUNCTION bt_index_check(regclass, bool) TO backup;
</pre></div><div class="refsect2"><a id="pbk-setting-up-partial-restore"></a><h3>Setting up Partial Restore</h3><p>
      If you are planning to use partial restore, complete the
      following additional step:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Grant the read-only access to <code class="literal">pg_catalog.pg_database</code> to the
          <code class="literal">backup</code> role only in the database
          <span class="strong"><strong>used for connection</strong></span> to
          <span class="productname">PostgreSQL</span> server:
        </p><pre class="programlisting">
GRANT SELECT ON TABLE pg_catalog.pg_database TO backup;
</pre></li></ul></div></div><div class="refsect2"><a id="pbk-configuring-the-remote-mode"></a><h3>Configuring the Remote Mode</h3><p>
      <span class="application">pg_probackup</span> supports the remote mode that allows to perform
      backup, restore and WAL archiving operations remotely. In this
      mode, the backup catalog is stored on a local system, while
      <span class="productname">PostgreSQL</span> instance to backup and/or to restore is located on a
      remote system. Currently the only supported remote protocol is
      SSH.
    </p><div class="refsect3"><a id="pbk-setup-ssh"></a><h4>Set up SSH</h4><p>
        If you are going to use <span class="application">pg_probackup</span> in remote mode via SSH,
        complete the following steps:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Install <span class="application">pg_probackup</span> on both systems:
            <code class="literal">backup_host</code> and
            <code class="literal">db_host</code>.
          </p></li><li class="listitem"><p>
            For communication between the hosts set up the passwordless
            SSH connection between <code class="literal">backup</code> user on
            <code class="literal">backup_host</code> and
            <code class="literal">postgres</code> user on
            <code class="literal">db_host</code>:
          </p><pre class="programlisting">
[backup@backup_host] ssh-copy-id postgres@db_host
</pre></li><li class="listitem"><p>
            If you are going to rely on
            <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
            WAL archiving</a>, set up passwordless SSH
            connection between <code class="literal">postgres</code> user on
            <code class="literal">db_host</code> and <code class="literal">backup</code>
            user on <code class="literal">backup_host</code>:
          </p><pre class="programlisting">
[postgres@db_host] ssh-copy-id backup@backup_host
</pre></li></ul></div><p>
        where:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">backup_host</code> is the system with
            <span class="emphasis"><em>backup catalog</em></span>.
          </p></li><li class="listitem"><p>
            <code class="literal">db_host</code> is the system with <span class="productname">PostgreSQL</span>
            cluster.
          </p></li><li class="listitem"><p>
            <code class="literal">backup</code> is the OS user on
            <code class="literal">backup_host</code> used to run <span class="application">pg_probackup</span>.
          </p></li><li class="listitem"><p>
            <code class="literal">postgres</code> is the OS user on
            <code class="literal">db_host</code> used to start the <span class="productname">PostgreSQL</span>
            cluster. For <span class="productname">PostgreSQL</span> 11 or higher a
            more secure approach can be used thanks to
            <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/app-initdb.html#APP-INITDB-ALLOW-GROUP-ACCESS" target="_top">allow-group-access</a>
            feature.
          </p></li></ul></div><p>
        <span class="application">pg_probackup</span> in the remote mode via SSH works
        as follows:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            Only the following commands can be launched in the remote
            mode: <a class="xref" href="#pbk-add-instance" title="add-instance">add-instance</a>,
            <a class="xref" href="#pbk-backup" title="backup">backup</a>,
            <a class="xref" href="#pbk-restore" title="restore">restore</a>,
            <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a>,
            <a class="xref" href="#pbk-archive-get" title="archive-get">archive-get</a>.
          </p></li><li class="listitem"><p>
            When started in the remote mode, the main <span class="application">pg_probackup</span> process
            on the local system connects to the remote system via SSH and
            launches one or more agent processes on the remote system, which are called
            <em class="firstterm">remote agents</em>. The number of remote agents
            is equal to the <code class="option">-j</code>/<code class="option">--threads</code> setting.
          </p></li><li class="listitem"><p>
            The main <span class="application">pg_probackup</span> process uses remote agents to access
            remote files and transfer data between local and remote
            systems.
          </p></li><li class="listitem"><p>
            Remote agents try to minimize the network traffic and the number of
            round-trips between hosts.
          </p></li><li class="listitem"><p>
            The main process is usually started on
            <em class="replaceable"><code>backup_host</code></em> and connects to
            <em class="replaceable"><code>db_host</code></em>, but in case of
            <span class="command"><strong>archive-push</strong></span> and
            <span class="command"><strong>archive-get</strong></span> commands the main process
            is started on <em class="replaceable"><code>db_host</code></em> and connects to
            <em class="replaceable"><code>backup_host</code></em>.
          </p></li><li class="listitem"><p>
            Once data transfer is complete, remote agents are
            terminated and SSH connections are closed.
          </p></li><li class="listitem"><p>
            If an error condition is encountered by a remote agent,
            then all agents are terminated and error details are
            reported by the main <span class="application">pg_probackup</span> process, which exits
            with an error.
          </p></li><li class="listitem"><p>
            Compression is always done on
            <em class="replaceable"><code>db_host</code></em>, while decompression is always done on
            <em class="replaceable"><code>backup_host</code></em>.
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          You can impose
          <a class="ulink" href="https://man.openbsd.org/OpenBSD-current/man8/sshd.8#AUTHORIZED_KEYS_FILE_FORMAT" target="_top">additional
          restrictions</a> on SSH settings to protect the system
          in the event of account compromise.
        </p></div></div></div><div class="refsect2"><a id="pbk-setting-up-ptrack-backups"></a><h3>Setting up PTRACK Backups</h3><p>
      The PTRACK backup mode can be used only for <span class="productname">Postgres Pro Standard</span> and
      <span class="productname">Postgres Pro Enterprise</span> installations, or patched vanilla
      PostgreSQL. Links to PTRACK patches can be found
      <a class="ulink" href="https://github.com/postgrespro/pg_probackup#ptrack-support" target="_top">here</a>.
    </p><p>
      If you are going to use PTRACK backups, complete the following
      additional steps. The role that will perform PTRACK backups
      (the <code class="literal">backup</code> role in the examples below) must have
      access to all the databases of the cluster.
    </p><p>
    For <span class="productname">PostgreSQL</span> 12 or higher:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Create PTRACK extension:
       </p><pre class="programlisting">
CREATE EXTENSION ptrack;
</pre><p>
      </p></li><li class="listitem"><p>
       To enable tracking page updates, set <code class="varname">ptrack.map_size</code>
       parameter to a positive integer and restart the server.
      </p><p>
       For optimal performance, it is recommended to set
       <code class="varname">ptrack.map_size</code> to
       <code class="literal"><em class="replaceable"><code>N</code></em> / 1024</code>, where
       <em class="replaceable"><code>N</code></em> is the size of the
       <span class="productname">PostgreSQL</span> cluster, in MB. If you set this
       parameter to a lower value, PTRACK is more likely to map several blocks
       together, which leads to false-positive results when tracking changed
       blocks and increases the incremental backup size as unchanged blocks
       can also be copied into the incremental backup.
       Setting <code class="varname">ptrack.map_size</code> to a higher value
       does not affect PTRACK operation. The maximum allowed value is 1024.
      </p></li><li class="listitem"><p>
       Grant the right to execute <span class="application">PTRACK</span>
       functions to the <code class="literal">backup</code> role
       in the database used to connect to the cluster:
      </p><pre class="programlisting">
GRANT EXECUTE ON FUNCTION pg_ptrack_get_pagemapset(pg_lsn) TO backup;
GRANT EXECUTE ON FUNCTION pg_ptrack_control_lsn() TO backup;
GRANT EXECUTE ON FUNCTION pg_ptrack_get_block(oid, oid, oid, bigint) TO backup;
</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
     If you change the <code class="varname">ptrack.map_size</code> parameter value,
     the previously created PTRACK map file is cleared,
     and tracking newly changed blocks starts from scratch. Thus, you have
     to retake a full backup before taking incremental PTRACK backups after
     changing <code class="varname">ptrack.map_size</code>.
    </p></div><p>
     For older <span class="productname">PostgreSQL</span> versions,
     PTRACK required taking backups in the exclusive mode
     to provide exclusive access to bitmaps with changed blocks.
     To set up PTRACK backups for <span class="productname">PostgreSQL</span> 11
     or lower, do the following:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Set the <em class="parameter"><code>ptrack_enable</code></em> parameter to
          <code class="literal">on</code>.
        </p></li><li class="listitem"><p>
          Grant the right to execute <span class="application">PTRACK</span>
          functions to the <code class="literal">backup</code> role
          <span class="strong"><strong>in every database</strong></span> of the
          cluster:
        </p><pre class="programlisting">
GRANT EXECUTE ON FUNCTION pg_catalog.pg_ptrack_clear() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_ptrack_get_and_clear(oid, oid) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_stop_backup() TO backup;
</pre></li></ol></div></div></div><div class="refsect1"><a id="pbk-usage"></a><h2>Usage</h2><div class="refsect2"><a id="pbk-creating-backup"></a><h3>Creating a Backup</h3><p>
      To create a backup, run the following command:
    </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b <em class="replaceable"><code>backup_mode</code></em>
</pre><p>
      Where <em class="replaceable"><code>backup_mode</code></em> can take one of the
      following values:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          FULL — creates a full backup that contains all the data
          files of the cluster to be restored.
        </p></li><li class="listitem"><p>
          DELTA — reads all data files in the data directory and
          creates an incremental backup for pages that have changed
          since the previous backup.
        </p></li><li class="listitem"><p>
          PAGE — creates an incremental backup based on the WAL
          files that have been generated since the previous full or
          incremental backup was taken. Only changed blocks are read
          from data files.
        </p></li><li class="listitem"><p>
          PTRACK — creates an incremental backup tracking page
          changes on the fly.
        </p></li></ul></div><p>
      When restoring a cluster from an incremental backup,
      <span class="application">pg_probackup</span> relies on the parent full backup and all the
      incremental backups between them, which is called
      <span class="quote">“<span class="quote">the backup chain</span>”</span>. You must create at least
      one full backup before taking incremental ones.
    </p><div class="refsect3"><a id="pbk-archive-mode"></a><h4>ARCHIVE Mode</h4><p>
        ARCHIVE is the default WAL delivery mode.
      </p><p>
        For example, to make a FULL backup in ARCHIVE mode, run:
      </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL
</pre><p>
        ARCHIVE backups rely on
        <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
        archiving</a> to get WAL segments required to restore
        the cluster to a consistent state at the time the backup was
        taken.
      </p><p>
        When a backup is taken, <span class="application">pg_probackup</span>
        ensures that WAL files containing WAL records between <code class="literal">Start
        LSN</code> and <code class="literal">Stop LSN</code> actually exist in
        <code class="filename"><em class="replaceable"><code>backup_dir</code></em>/wal/<em class="replaceable"><code>instance_name</code></em></code>
        directory. <span class="application">pg_probackup</span> also ensures that WAL records between
        <code class="literal">Start LSN</code> and <code class="literal">Stop LSN</code> can be parsed. This precaution
        eliminates the risk of silent WAL corruption.
      </p></div><div class="refsect3"><a id="pbk-stream-mode"></a><h4>STREAM Mode</h4><p>
        STREAM is the optional WAL delivery mode.
      </p><p>
        For example, to make a FULL backup in the STREAM mode, add the
        <code class="option">--stream</code> flag to the command from the
        previous example:
      </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL --stream --temp-slot
</pre><p>
        The optional <code class="option">--temp-slot</code> flag ensures that
        the required segments remain available if the WAL is rotated
        before the backup is complete.
      </p><p>
        Unlike backups in ARCHIVE mode, STREAM backups include all the
        WAL segments required to restore the cluster to a consistent
        state at the time the backup was taken.
      </p><p>
        During <a class="xref" href="#pbk-backup" title="backup">backup</a> <span class="application">pg_probackup</span>
        streams WAL files containing WAL records between <code class="literal">Start LSN</code> and
        <code class="literal">Stop LSN</code> to
        <code class="filename"><em class="replaceable"><code>backup_dir</code></em>/backups/<em class="replaceable"><code>instance_name</code></em>/<em class="replaceable"><code>backup_id</code></em>/database/pg_wal</code> directory. To eliminate the risk
        of silent WAL corruption, <span class="application">pg_probackup</span> also
        checks that WAL records between <code class="literal">Start LSN</code> and
        <code class="literal">Stop LSN</code> can be parsed.
      </p><p>
        Even if you are using
        <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
        archiving</a>, STREAM backups can still be useful in the
        following cases:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            STREAM backups can be restored on the server that has no
            file access to WAL archive.
          </p></li><li class="listitem"><p>
            STREAM backups enable you to restore the cluster state at
            the point in time for which WAL files in archive are no
            longer available.
          </p></li><li class="listitem"><p>
            Backup in STREAM mode can be taken from a standby of a
            server that generates small amount of WAL traffic,
            without long waiting for WAL segment to fill up.
          </p></li></ul></div></div><div class="refsect3"><a id="pbk-page-validation"></a><h4>Page Validation</h4><p>
        If
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-preset.html#GUC-DATA-CHECKSUMS" target="_top">data
        checksums</a> are enabled in the database cluster,
        <span class="application">pg_probackup</span> uses this information to check correctness of
        data files during backup. While reading each page,
        <span class="application">pg_probackup</span> checks whether the calculated checksum coincides
        with the checksum stored in the page header. This guarantees
        that the <span class="productname">PostgreSQL</span> instance and the backup itself have no
        corrupt pages. Note that <span class="application">pg_probackup</span> reads database files
        directly from the filesystem, so under heavy write load during
        backup it can show false-positive checksum mismatches because of
        partial writes. If a page checksum mismatch occurs, the page is
        re-read and checksum comparison is repeated.
      </p><p>
        A page is considered corrupt if checksum comparison has failed
        more than 100 times. In this case, the backup is aborted.
      </p><p>
        Even if data checksums are not enabled, <span class="application">pg_probackup</span>
        always performs sanity checks for page headers.
      </p></div><div class="refsect3"><a id="pbk-external-directories"></a><h4>External Directories</h4><p>
        To back up a directory located outside of the data directory,
        use the optional <code class="option">--external-dirs</code> parameter
        that specifies the path to this directory. If you would like
        to add more than one external directory, you can provide several paths
        separated by colons on Linux systems or semicolons on Windows systems.
      </p><p>
        For example, to include <code class="filename">/etc/dir1</code> and
        <code class="filename">/etc/dir2</code> directories into the full
        backup of your <em class="replaceable"><code>instance_name</code></em> instance
        that will be stored under the <em class="replaceable"><code>backup_dir</code></em>
        directory on Linux, run:
      </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL --external-dirs=/etc/dir1:/etc/dir2
</pre><p>
        Similarly, to include <code class="filename">C:\dir1</code> and
        <code class="filename">C:\dir2</code> directories into the full backup
        on Windows, run:
      </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL --external-dirs=C:\dir1;C:\dir2
</pre><p>
        <span class="application">pg_probackup</span> recursively copies the contents
        of each external directory into a separate subdirectory in the backup
        catalog. Since external directories included into different backups
        do not have to be the same, when you are restoring the cluster from an
        incremental backup, only those directories that belong to this
        particular backup will be restored. Any external directories
        stored in the previous backups will be ignored.
      </p><p>
        To include the same directories into each backup of your
        instance, you can specify them in the <code class="filename">pg_probackup.conf</code>
        configuration file using the
        <a class="xref" href="#pbk-set-config" title="set-config">set-config</a> command with the
        <code class="option">--external-dirs</code> option.
      </p></div></div><div class="refsect2"><a id="pbk-verifying-a-cluster"></a><h3>Performing Cluster Verification</h3><p>
      To verify that <span class="productname">PostgreSQL</span> database cluster is
      not corrupt, run the following command:
    </p><pre class="programlisting">
pg_probackup checkdb [-B <em class="replaceable"><code>backup_dir</code></em> [--instance <em class="replaceable"><code>instance_name</code></em>]] [-D <em class="replaceable"><code>data_dir</code></em>] [<em class="replaceable"><code>connection_options</code></em>]
</pre><p>
      This command performs physical verification of all data files
      located in the specified data directory by running page header
      sanity checks, as well as block-level checksum verification if checksums are enabled.
      If a corrupt page is detected, <span class="command"><strong>checkdb</strong></span>
      continues cluster verification until all pages in the cluster
      are validated.
    </p><p>
      By default, similar <a class="link" href="#pbk-page-validation" title="Page Validation">page validation</a>
      is performed automatically while a backup is taken by
      <span class="application">pg_probackup</span>. The <code class="literal">checkdb</code>
      command enables you to perform such page validation
      on demand, without taking any backup copies, even if the cluster
      is not backed up using <span class="application">pg_probackup</span> at all.
    </p><p>
      To perform cluster verification, <span class="application">pg_probackup</span>
      needs to connect to the cluster to be verified. In general, it is
      enough to specify the backup instance of this cluster for
      <span class="application">pg_probackup</span> to determine the required
      connection options. However, if <code class="literal">-B</code> and
      <code class="literal">--instance</code> options are omitted, you have to provide
      <a class="link" href="#pbk-connection-opts" title="Connection Options">connection options</a> and
      <em class="replaceable"><code>data_dir</code></em> via environment
      variables or command-line options.
    </p><p>
      Physical verification cannot detect logical inconsistencies,
      missing or nullified blocks and entire files, or similar anomalies. Extensions
      <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/amcheck.html" target="_top">amcheck</a>
      and
      <a class="ulink" href="https://github.com/petergeoghegan/amcheck" target="_top">amcheck_next</a>
      provide a partial solution to these problems.
    </p><p>
      If you would like, in addition to physical verification, to
      verify all indexes in all databases using these extensions, you
      can specify the <code class="option">--amcheck</code> flag when running
      the <a class="xref" href="#pbk-checkdb" title="checkdb">checkdb</a> command:
    </p><pre class="programlisting">
pg_probackup checkdb -D <em class="replaceable"><code>data_dir</code></em> --amcheck [<em class="replaceable"><code>connection_options</code></em>]
</pre><p>
      You can skip physical verification by specifying the
      <code class="option">--skip-block-validation</code> flag. In this case,
      you can omit <span class="emphasis"><em>backup_dir</em></span> and
      <span class="emphasis"><em>data_dir</em></span> options, only
      <a class="link" href="#pbk-connection-opts" title="Connection Options">connection options</a> are
      mandatory:
    </p><pre class="programlisting">
pg_probackup checkdb --amcheck --skip-block-validation [<em class="replaceable"><code>connection_options</code></em>]
</pre><p>
      Logical verification can be done more thoroughly with the
      <code class="option">--heapallindexed</code> flag by checking that all heap
      tuples that should be indexed are actually indexed, but at the
      higher cost of CPU, memory, and I/O consumption.
    </p></div><div class="refsect2"><a id="pbk-validating-backups"></a><h3>Validating a Backup</h3><p>
      <span class="application">pg_probackup</span> calculates checksums for each file in a backup
      during the backup process. The process of checking checksums of
      backup data files is called
      <em class="firstterm">the backup validation</em>. By default, validation
      is run immediately after the backup is taken and right before the
      restore, to detect possible backup corruption.
    </p><p>
      If you would like to skip backup validation, you can specify the
      <code class="option">--no-validate</code> flag when running
      <a class="xref" href="#pbk-backup" title="backup">backup</a> and
      <a class="xref" href="#pbk-restore" title="restore">restore</a> commands.
    </p><p>
      To ensure that all the required backup files are present and can
      be used to restore the database cluster, you can run the
      <a class="xref" href="#pbk-validate" title="validate">validate</a> command with the exact
      <a class="link" href="#pbk-recovery-target-opts" title="Recovery Target Options">recovery target
      options</a> you are going to use for recovery.
    </p><p>
      For example, to check that you can restore the database cluster
      from a backup copy up to transaction ID 4242, run
      this command:
    </p><pre class="programlisting">
pg_probackup validate -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --recovery-target-xid=4242
</pre><p>
      If validation completes successfully, <span class="application">pg_probackup</span> displays the
      corresponding message. If validation fails, you will receive an
      error message with the exact time, transaction ID, and LSN up to
      which the recovery is possible.
    </p><p>
      If you specify <span class="emphasis"><em>backup_id</em></span> via
      <code class="literal">-i/--backup-id</code> option, then only the backup copy
      with specified backup ID will be validated. If
      <span class="emphasis"><em>backup_id</em></span> is specified with
      <a class="link" href="#pbk-recovery-target-opts" title="Recovery Target Options">recovery target
      options</a>, the <span class="command"><strong>validate</strong></span> command will check whether it is possible
      to restore the specified backup to the specified
      recovery target.
    </p><p>
      For example, to check that you can restore the database cluster
      from a backup copy with the <code class="literal">PT8XFX</code> backup ID up to the
      specified timestamp, run this command:
    </p><pre class="programlisting">
pg_probackup validate -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i PT8XFX --recovery-target-time='2017-05-18 14:18:11+03'
</pre><p>
      If you specify the <em class="replaceable"><code>backup_id</code></em> of an incremental backup,
      all its parents starting from FULL backup will be
      validated.
    </p><p>
      If you omit all the parameters, all backups are validated.
    </p></div><div class="refsect2"><a id="pbk-restoring-a-cluster"></a><h3>Restoring a Cluster</h3><p>
      To restore the database cluster from a backup, run the <a class="xref" href="#pbk-restore" title="restore">restore</a>
      command with at least the following options:
    </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
</pre><p>
      where:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <em class="replaceable"><code>backup_dir</code></em> is the backup catalog that
          stores all backup files and meta information.
        </p></li><li class="listitem"><p>
          <em class="replaceable"><code>instance_name</code></em> is the backup instance
          for the cluster to be restored.
        </p></li><li class="listitem"><p>
          <em class="replaceable"><code>backup_id</code></em> specifies the backup to
          restore the cluster from. If you omit this option,
          <span class="application">pg_probackup</span> uses the latest valid backup available for the
          specified instance. If you specify an incremental backup to
          restore, <span class="application">pg_probackup</span> automatically restores the underlying
          full backup and then sequentially applies all the necessary
          increments.
        </p></li></ul></div><p>
     Once the <code class="literal">restore</code> command is complete, start
     the database service.
    </p><p>
     If you restore <a class="link" href="#pbk-archive-mode" title="ARCHIVE Mode">ARCHIVE</a> backups,
     perform <a class="link" href="#pbk-performing-point-in-time-pitr-recovery" title="Performing Point-in-Time (PITR) Recovery">PITR</a>,
     or specify the <code class="literal">--restore-as-replica</code> flag with the
     <code class="literal">restore</code> command to set up a standby server,
     <span class="application">pg_probackup</span> creates a recovery configuration
     file once all data files are copied into the target directory. This file
     includes the minimal settings required for recovery, except for the password in the
     <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-replication.html#GUC-PRIMARY-CONNINFO" target="_top">primary_conninfo</a>
     parameter; you have to add the password manually or use
     the <code class="literal">--primary-conninfo</code> option, if required.
     For <span class="productname">PostgreSQL</span> 11 or lower,
     recovery settings are written into the <code class="filename">recovery.conf</code>
     file. Starting from <span class="productname">PostgreSQL</span> 12,
     <span class="application">pg_probackup</span> writes these settings into
     the <code class="filename">probackup_recovery.conf</code> file and then includes
     it into <code class="filename">postgresql.auto.conf</code>.
    </p><p>
      If you are restoring a STREAM backup, the restore is complete
      at once, with the cluster returned to a self-consistent state at
      the point when the backup was taken. For ARCHIVE backups,
      <span class="productname">PostgreSQL</span> replays all available archived WAL
      segments, so the cluster is restored to the latest state possible
      within the current timeline. You can change this behavior by using the
      <a class="link" href="#pbk-recovery-target-opts" title="Recovery Target Options">recovery target
      options</a> with the <code class="literal">restore</code> command,
      as explained in <a class="xref" href="#pbk-performing-point-in-time-pitr-recovery" title="Performing Point-in-Time (PITR) Recovery">the section called “Performing Point-in-Time (PITR) Recovery”</a>.
    </p><p>
      If the cluster to restore contains tablespaces, <span class="application">pg_probackup</span>
      restores them to their original location by default. To restore
      tablespaces to a different location, use the
      <code class="option">--tablespace-mapping</code>/<code class="option">-T</code> option. Otherwise,
      restoring the cluster on the same host will fail if tablespaces
      are in use, because the backup would have to be written to the
      same directories.
    </p><p>
      When using the <code class="option">--tablespace-mapping</code>/<code class="option">-T</code>
      option, you must provide absolute paths to the old and new
      tablespace directories. If a path happens to contain an equals
      sign (<code class="literal">=</code>), escape it with a backslash. This option can be
      specified multiple times for multiple tablespaces. For example:
    </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -D <em class="replaceable"><code>data_dir</code></em> -j 4 -i <em class="replaceable"><code>backup_id</code></em> -T tablespace1_dir=<em class="replaceable"><code>tablespace1_newdir</code></em> -T tablespace2_dir=<em class="replaceable"><code>tablespace2_newdir</code></em>
</pre><p>
      To restore the cluster on a remote host, follow the instructions in
      <a class="xref" href="#pbk-remote-backup" title="Using pg_probackup in the Remote Mode">the section called “Using <span class="application">pg_probackup</span> in the Remote Mode”</a>.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        By default, the <a class="xref" href="#pbk-restore" title="restore">restore</a>
        command validates the specified backup before restoring the
        cluster. If you run regular backup validations and would like
        to save time when restoring the cluster, you can specify the
        <code class="option">--no-validate</code> flag to skip validation and
        speed up the recovery.
      </p></div><div class="refsect3"><a id="pbk-partial-restore"></a><h4>Partial Restore</h4><p>
        If you have enabled
        <a class="link" href="#pbk-setting-up-partial-restore" title="Setting up Partial Restore">partial
        restore</a> before taking backups, you can restore
        only some of the databases using
        <a class="link" href="#pbk-partial-restore-options" title="Partial Restore Options">partial restore
        options</a> with the <a class="xref" href="#pbk-restore" title="restore">restore</a>
        commands.
      </p><p>
        To restore the specified databases only, run the <a class="xref" href="#pbk-restore" title="restore">restore</a> command
        with the following options:
      </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --db-include=<em class="replaceable"><code>database_name</code></em>
</pre><p>
        The <code class="option">--db-include</code> option can be specified
        multiple times. For example, to restore only databases
        <code class="literal">db1</code> and <code class="literal">db2</code>, run the
        following command:
      </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --db-include=db1 --db-include=db2
</pre><p>
        To exclude one or more databases from restore, use
        the <code class="option">--db-exclude</code> option:
      </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --db-exclude=<em class="replaceable"><code>database_name</code></em>
</pre><p>
        The <code class="option">--db-exclude</code> option can be specified
        multiple times. For example, to exclude the databases
        <code class="literal">db1</code> and <code class="literal">db2</code> from
        restore, run the following command:
      </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --db-exclude=db1 --db-exclude=db2
</pre><p>
        Partial restore relies on lax behavior of <span class="productname">PostgreSQL</span> recovery
        process toward truncated files. For recovery to work properly, files of excluded databases
        are restored as files of zero size. After the <span class="productname">PostgreSQL</span> cluster is successfully started,
        you must drop the excluded databases using
        <span class="command"><strong>DROP DATABASE</strong></span> command.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          The <code class="literal">template0</code> and
          <code class="literal">template1</code> databases are always restored.
        </p></div></div></div><div class="refsect2"><a id="pbk-performing-point-in-time-pitr-recovery"></a><h3>Performing Point-in-Time (PITR) Recovery</h3><p>
      If you have enabled
      <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
      WAL archiving</a> before taking backups, you can restore the
      cluster to its state at an arbitrary point in time (recovery
      target) using <a class="link" href="#pbk-recovery-target-opts" title="Recovery Target Options">recovery
      target options</a> with the
      <a class="xref" href="#pbk-restore" title="restore">restore</a> command.
    </p><p>
      You can use both STREAM and ARCHIVE backups for point in time
      recovery as long as the WAL archive is available at least starting
      from the time the backup was taken.
      If <code class="option">-i</code>/<code class="option">--backup-id</code> option is omitted,
      <span class="application">pg_probackup</span> automatically chooses the backup that is the
      closest to the specified recovery target and starts the restore
      process, otherwise <span class="application">pg_probackup</span> will try to restore
      the specified backup to the specified recovery target.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          To restore the cluster state at the exact time, specify the
          <code class="option">--recovery-target-time</code> option, in the
          timestamp format. For example:
        </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --recovery-target-time='2017-05-18 14:18:11+03'
</pre></li><li class="listitem"><p>
          To restore the cluster state up to a specific transaction
          ID, use the <code class="option">--recovery-target-xid</code> option:
        </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --recovery-target-xid=687
</pre></li><li class="listitem"><p>
          To restore the cluster state up to the specific LSN, use
          <code class="option">--recovery-target-lsn</code> option:
        </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --recovery-target-lsn=16/B374D848
</pre></li><li class="listitem"><p>
          To restore the cluster state up to the specific named restore
          point, use <code class="option">--recovery-target-name</code> option:
        </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --recovery-target-name='before_app_upgrade'
</pre></li><li class="listitem"><p>
          To restore the backup to the latest state available in
          the WAL archive, use <code class="option">--recovery-target</code> option
          with <code class="literal">latest</code> value:
        </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --recovery-target='latest'
</pre></li><li class="listitem"><p>
          To restore the cluster to the earliest point of consistency,
          use <code class="option">--recovery-target</code> option with the
          <code class="literal">immediate</code> value:
        </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --recovery-target='immediate'
</pre></li></ul></div></div><div class="refsect2"><a id="pbk-remote-backup"></a><h3>Using <span class="application">pg_probackup</span> in the Remote Mode</h3><p>
      <span class="application">pg_probackup</span> supports the remote mode that allows to perform
      <code class="literal">backup</code> and <code class="literal">restore</code>
      operations remotely via SSH. In this mode, the backup catalog is
      stored on a local system, while <span class="productname">PostgreSQL</span> instance to be backed
      up is located on a remote system. You must have <span class="application">pg_probackup</span>
      installed on both systems.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      <span class="application">pg_probackup</span> relies on passwordless SSH connection
      for communication between the hosts.
     </p></div><p>
      The typical workflow is as follows:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          On your backup host, configure <span class="application">pg_probackup</span> as explained in
          the section
          <a class="link" href="#pbk-install-and-setup" title="Installation and Setup">Installation and
          Setup</a>. For the
          <a class="xref" href="#pbk-add-instance" title="add-instance">add-instance</a> and
          <a class="xref" href="#pbk-set-config" title="set-config">set-config</a> commands, make
          sure to specify <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote
          options</a> that point to the database host with the
          <span class="productname">PostgreSQL</span> instance.
        </p></li><li class="listitem"><p>
          If you would like to take remote backups in
          <a class="link" href="#pbk-creating-backup" title="Creating a Backup">PAGE</a> mode, or rely
          on <a class="link" href="#pbk-archive-mode" title="ARCHIVE Mode">ARCHIVE</a> WAL delivery
          mode, or use
          <a class="link" href="#pbk-performing-point-in-time-pitr-recovery" title="Performing Point-in-Time (PITR) Recovery">PITR</a>,
          configure continuous WAL archiving from the database host
          to the backup host as explained in the section
          <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">Setting
          up continuous WAL archiving</a>. For the
          <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> and
          <a class="xref" href="#pbk-archive-get" title="archive-get">archive-get</a> commands, you
          must specify the <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote
          options</a> that point to the backup host with the backup
          catalog.
        </p></li><li class="listitem"><p>
          Run <a class="xref" href="#pbk-backup" title="backup">backup</a> or
          <a class="xref" href="#pbk-restore" title="restore">restore</a> commands with
          <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote options</a>
          <span class="strong"><strong>on the backup host</strong></span>.
          <span class="application">pg_probackup</span> connects to the remote system via SSH and
          creates a backup locally or restores the previously taken
          backup on the remote system, respectively.
        </p></li></ul></div><p>
      For example, to create an archive full backup of a
      <span class="productname">PostgreSQL</span> cluster located on
      a remote system with host address <code class="literal">192.168.0.2</code>
      on behalf of the <code class="literal">postgres</code> user via SSH connection
      through port <code class="literal">2302</code>, run:
    </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL --remote-user=postgres --remote-host=192.168.0.2 --remote-port=2302
</pre><p>
      To restore the latest available backup on a remote system with host address
      <code class="literal">192.168.0.2</code> on behalf of the <code class="literal">postgres</code>
      user via SSH connection through port <code class="literal">2302</code>, run:
    </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --remote-user=postgres --remote-host=192.168.0.2 --remote-port=2302
</pre><p>
      Restoring an ARCHIVE backup or performing PITR in the remote mode
      require additional information: destination address, port and
      username for establishing an SSH connection
      <span class="strong"><strong>from</strong></span> the host with database
      <span class="strong"><strong>to</strong></span> the host with the backup
      catalog. This information will be used by the
      <span class="command"><strong>restore_command</strong></span> to copy WAL segments
      from the archive to the <span class="productname">PostgreSQL</span> <code class="filename">pg_wal</code> directory.
    </p><p>
      To solve this problem, you can use
      <a class="link" href="#pbk-remote-wal-archive-options" title="Remote WAL Archive Options">Remote WAL Archive
      Options</a>.
    </p><p>
      For example, to restore latest backup on remote system using
      remote mode through SSH connection to user
      <code class="literal">postgres</code> on host with address
      <code class="literal">192.168.0.2</code> via port <code class="literal">2302</code>
      and user <code class="literal">backup</code> on backup catalog host with
      address <code class="literal">192.168.0.3</code> via port
      <code class="literal">2303</code>, run:
    </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --remote-user=postgres --remote-host=192.168.0.2 --remote-port=2302 --archive-host=192.168.0.3 --archive-port=2303 --archive-user=backup
</pre><p>
      Provided arguments will be used to construct the <span class="command"><strong>restore_command</strong></span>:
    </p><pre class="programlisting">
restore_command = '<em class="replaceable"><code>install_dir</code></em>/pg_probackup archive-get -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --wal-file-path=%p --wal-file-name=%f --remote-host=192.168.0.3 --remote-port=2303 --remote-user=backup'
</pre><p>
      Alternatively, you can use the <code class="option">--restore-command</code>
      option to provide the entire <em class="parameter"><code>restore_command</code></em>:
    </p><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --remote-user=postgres --remote-host=192.168.0.2 --remote-port=2302 --restore-command='<em class="replaceable"><code>install_dir</code></em>/pg_probackup archive-get -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --wal-file-path=%p --wal-file-name=%f --remote-host=192.168.0.3 --remote-port=2303 --remote-user=backup'
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        The remote mode is currently unavailable for
        Windows systems.
      </p></div></div><div class="refsect2"><a id="pbk-running-pg-probackup-on-parallel-threads"></a><h3>Running <span class="application">pg_probackup</span> on Parallel Threads</h3><p>
      <a class="xref" href="#pbk-backup" title="backup">backup</a>,
      <a class="xref" href="#pbk-restore" title="restore">restore</a>,
      <a class="xref" href="#pbk-merge" title="merge">merge</a>,
      <a class="xref" href="#pbk-delete" title="delete">delete</a>,
      <a class="xref" href="#pbk-checkdb" title="checkdb">checkdb</a> and
      <a class="xref" href="#pbk-validate" title="validate">validate</a> processes can be
      executed on several parallel threads. This can significantly
      speed up <span class="application">pg_probackup</span> operation given enough resources (CPU
      cores, disk, and network bandwidth).
    </p><p>
      Parallel execution is controlled by the
      <code class="literal">-j/--threads</code> command-line option. For
      example, to create a backup using four parallel threads, run:
    </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL -j 4
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        Parallel restore applies only to copying data from the
        backup catalog to the data directory of the cluster. When
        <span class="productname">PostgreSQL</span> server is started, WAL records need to be replayed,
        and this cannot be done in parallel.
      </p></div></div><div class="refsect2"><a id="pbk-configuring-pg-probackup"></a><h3>Configuring <span class="application">pg_probackup</span></h3><p>
      Once the backup catalog is initialized and a new backup instance
      is added, you can use the <code class="filename">pg_probackup.conf</code> configuration file
      located in the
      <code class="filename"><em class="replaceable"><code>backup_dir</code></em>/backups/<em class="replaceable"><code>instance_name</code></em></code>
      directory to fine-tune <span class="application">pg_probackup</span> configuration.
    </p><p>
      For example, <a class="xref" href="#pbk-backup" title="backup">backup</a> and
      <a class="xref" href="#pbk-checkdb" title="checkdb">checkdb</a> commands use a regular
      <span class="productname">PostgreSQL</span> connection. To avoid specifying
      <a class="link" href="#pbk-connection-opts" title="Connection Options">connection options</a>
      each time on the command line, you can set them in the
      <code class="filename">pg_probackup.conf</code> configuration file using the
      <a class="xref" href="#pbk-set-config" title="set-config">set-config</a> command.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        It is <span class="strong"><strong>not recommended</strong></span>
        to edit <code class="filename">pg_probackup.conf</code> manually.
      </p></div><p>
      Initially, <code class="filename">pg_probackup.conf</code> contains the following settings:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="varname">PGDATA</code> — the path to the data directory of the cluster to
          back up.
        </p></li><li class="listitem"><p>
          <code class="varname">system-identifier</code> — the unique identifier of the <span class="productname">PostgreSQL</span>
          instance.
        </p></li></ul></div><p>
      Additionally, you can define
      <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote</a>,
      <a class="link" href="#pbk-retention-opts" title="Retention Options">retention</a>,
      <a class="link" href="#pbk-logging-opts" title="Logging Options">logging</a>, and
      <a class="link" href="#pbk-compression-opts" title="Compression Options">compression</a> settings
      using the <span class="command"><strong>set-config</strong></span> command:
    </p><pre class="programlisting">
pg_probackup set-config -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em>
[--external-dirs=<em class="replaceable"><code>external_directory_path</code></em>] [<em class="replaceable"><code>remote_options</code></em>] [<em class="replaceable"><code>connection_options</code></em>] [<em class="replaceable"><code>retention_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
      To view the current settings, run the following command:
    </p><pre class="programlisting">
pg_probackup show-config -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em>
</pre><p>
      You can override the settings defined in <code class="filename">pg_probackup.conf</code> when
      running <span class="application">pg_probackup</span> <a class="link" href="#pbk-commands" title="Commands">commands</a>
      via the corresponding environment variables and/or command line
      options.
    </p></div><div class="refsect2"><a id="pbk-specifying-connection-settings"></a><h3>Specifying Connection Settings</h3><p>
      If you define connection settings in the <code class="filename">pg_probackup.conf</code>
      configuration file, you can omit connection options in all the
      subsequent <span class="application">pg_probackup</span> commands. However, if the corresponding
      environment variables are set, they get higher priority. The
      options provided on the command line overwrite both environment
      variables and configuration file settings.
    </p><p>
      If nothing is given, the default values are taken. By default
      <span class="application">pg_probackup</span> tries to use local connection via Unix domain
      socket (<code class="literal">localhost</code> on Windows) and tries to get the database name
      and the user name from the <code class="envar">PGUSER</code> environment variable or the
      current OS user name.
    </p></div><div class="refsect2"><a id="pbk-managing-the-backup-catalog"></a><h3>Managing the Backup Catalog</h3><p>
      With <span class="application">pg_probackup</span>, you can manage backups from the command line:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="#pbk-viewing-backup-info" title="Viewing Backup Information">View backup
          information</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="#pbk-viewing-wal-archive-information" title="Viewing WAL Archive Information">View WAL
          Archive Information</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="#pbk-validating-backups" title="Validating a Backup">Validate backups</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="#pbk-merging-backups" title="Merging Backups">Merge backups</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="#pbk-deleting-backups" title="Deleting Backups">Delete backups</a>
        </p></li></ul></div><div class="refsect3"><a id="pbk-viewing-backup-info"></a><h4>Viewing Backup Information</h4><p>
        To view the list of existing backups for every instance, run
        the command:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em>
</pre><p>
        <span class="application">pg_probackup</span> displays the list of all the available backups.
        For example:
      </p><pre class="programlisting">
BACKUP INSTANCE 'node'
======================================================================================================================================
 Instance  Version  ID      Recovery time           Mode    WAL Mode  TLI  Time    Data   WAL  Zratio  Start LSN   Stop LSN    Status
======================================================================================================================================
 node      10       PYSUE8  2019-10-03 15:51:48+03  FULL    ARCHIVE   1/0   16s  9047kB  16MB    4.31  0/12000028  0/12000160  OK
 node      10       P7XDQV  2018-04-29 05:32:59+03  DELTA   STREAM    1/1   11s    19MB  16MB    1.00  0/15000060  0/15000198  OK
 node      10       P7XDJA  2018-04-29 05:28:36+03  PTRACK  STREAM    1/1   21s    32MB  32MB    1.00  0/13000028  0/13000198  OK
 node      10       P7XDHU  2018-04-29 05:27:59+03  PAGE    STREAM    1/1   15s    33MB  16MB    1.00  0/11000028  0/110001D0  OK
 node      10       P7XDHB  2018-04-29 05:27:15+03  FULL    STREAM    1/0   11s    39MB  16MB    1.00  0/F000028   0/F000198   OK
</pre><p>
        For each backup, the following information is provided:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Instance</code> — the instance name.
          </p></li><li class="listitem"><p>
            <code class="literal">Version</code> — <span class="productname">PostgreSQL</span> major version.
          </p></li><li class="listitem"><p>
            <code class="literal">ID</code> — the backup identifier.
          </p></li><li class="listitem"><p>
            <code class="literal">Recovery time</code> — the earliest moment for which you can
            restore the state of the database cluster.
          </p></li><li class="listitem"><p>
            <code class="literal">Mode</code> — the method used to take this backup. Possible
            values: <code class="literal">FULL</code>, <code class="literal">PAGE</code>, <code class="literal">DELTA</code>, <code class="literal">PTRACK</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">WAL Mode</code> — WAL delivery mode. Possible values: <code class="literal">STREAM</code>
            and <code class="literal">ARCHIVE</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">TLI</code> — timeline identifiers of the current backup and its
            parent.
          </p></li><li class="listitem"><p>
            <code class="literal">Time</code> — the time it took to perform the backup.
          </p></li><li class="listitem"><p>
            <code class="literal">Data</code> — the size of the data files in this backup. This
            value does not include the size of WAL files. For
            STREAM backups, the total size of the backup can be calculated
            as <code class="literal">Data</code> + <code class="literal">WAL</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">WAL</code> — the uncompressed size of WAL files
            that need to be applied during recovery for the backup to reach a consistent state.
          </p></li><li class="listitem"><p>
            <code class="literal">Zratio</code> — compression ratio calculated as
            <span class="quote">“<span class="quote">uncompressed-bytes</span>”</span> / <span class="quote">“<span class="quote">data-bytes</span>”</span>.
          </p></li><li class="listitem"><p>
            <code class="literal">Start LSN</code> — WAL log sequence number corresponding to the
            start of the backup process. REDO point for <span class="productname">PostgreSQL</span>
            recovery process to start from.
          </p></li><li class="listitem"><p>
            <code class="literal">Stop LSN</code> — WAL log sequence number corresponding to the
            end of the backup process. Consistency point for
            <span class="productname">PostgreSQL</span> recovery process.
          </p></li><li class="listitem"><p>
            <code class="literal">Status</code> — backup status. Possible values:
          </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">OK</code> — the backup is complete and valid.
              </p></li><li class="listitem"><p>
                <code class="literal">DONE</code> — the backup is complete, but was not validated.
              </p></li><li class="listitem"><p>
                <code class="literal">RUNNING</code> — the backup is in progress.
              </p></li><li class="listitem"><p>
                <code class="literal">MERGING</code> — the backup is being merged.
              </p></li><li class="listitem"><p>
                <code class="literal">MERGED</code> — the backup data files were
                successfully merged, but its metadata is in the process
                of being updated. Only full backups can have this status.
              </p></li><li class="listitem"><p>
                <code class="literal">DELETING</code> — the backup files are being deleted.
              </p></li><li class="listitem"><p>
                <code class="literal">CORRUPT</code> — some of the backup files are corrupt.
              </p></li><li class="listitem"><p>
                <code class="literal">ERROR</code> — the backup was aborted because of an
                unexpected error.
              </p></li><li class="listitem"><p>
                <code class="literal">ORPHAN</code> — the backup is invalid because one of its
                parent backups is corrupt or missing.
              </p></li></ul></div></li></ul></div><p>
        You can restore the cluster from the backup only if the backup
        status is <code class="literal">OK</code> or <code class="literal">DONE</code>.
      </p><p>
        To get more detailed information about the backup, run the
        <span class="command"><strong>show</strong></span> command with the backup ID:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
</pre><p>
        The sample output is as follows:
      </p><pre class="programlisting">
#Configuration
backup-mode = FULL
stream = false
compress-alg = zlib
compress-level = 1
from-replica = false

#Compatibility
block-size = 8192
wal-block-size = 8192
checksum-version = 1
program-version = 2.1.3
server-version = 10

#Result backup info
timelineid = 1
start-lsn = 0/04000028
stop-lsn = 0/040000f8
start-time = '2017-05-16 12:57:29'
end-time = '2017-05-16 12:57:31'
recovery-xid = 597
recovery-time = '2017-05-16 12:57:31'
expire-time = '2020-05-16 12:57:31'
data-bytes = 22288792
wal-bytes = 16777216
uncompressed-bytes = 39961833
pgdata-bytes = 39859393
status = OK
parent-backup-id = 'PT8XFX'
primary_conninfo = 'user=backup passfile=/var/lib/pgsql/.pgpass port=5432 sslmode=disable sslcompression=1 target_session_attrs=any'
</pre><p>
        Detailed output has additional attributes:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">compress-alg</code> — compression algorithm used during backup. Possible values:
          <code class="literal">zlib</code>, <code class="literal">pglz</code>, <code class="literal">none</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">compress-level</code> — compression level used during backup.
        </p></li><li class="listitem"><p>
          <code class="literal">from-replica</code> — was this backup taken on standby? Possible values:
          <code class="literal">1</code>, <code class="literal">0</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">block-size</code> — the <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-preset.html#GUC-BLOCK-SIZE" target="_top">block_size</a>
        setting of <span class="productname">PostgreSQL</span> cluster at the backup start.
        </p></li><li class="listitem"><p>
          <code class="literal">checksum-version</code> — are
          <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-preset.html#GUC-DATA-CHECKSUMS" target="_top">data
          block checksums</a> enabled in the backed up <span class="productname">PostgreSQL</span> cluster? Possible values: <code class="literal">1</code>, <code class="literal">0</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">program-version</code> — full version of <span class="application">pg_probackup</span> binary used to create the backup.
        </p></li><li class="listitem"><p>
          <code class="literal">start-time</code> — the backup start time.
        </p></li><li class="listitem"><p>
          <code class="literal">end-time</code> — the backup end time.
        </p></li><li class="listitem"><p>
          <code class="literal">expire-time</code> — the point in time
          when a pinned backup can be removed in accordance with retention
          policy. This attribute is only available for pinned backups.
        </p></li><li class="listitem"><p>
          <code class="literal">uncompressed-bytes</code> — the size of data files before adding page headers and applying
          compression. You can evaluate the effectiveness of compression
          by comparing <code class="literal">uncompressed-bytes</code> to <code class="literal">data-bytes</code> if
          compression if used.
        </p></li><li class="listitem"><p>
          <code class="literal">pgdata-bytes</code> — the size of <span class="productname">PostgreSQL</span>
          cluster data files at the time of backup. You can evaluate the
          effectiveness of an incremental backup by comparing
          <code class="literal">pgdata-bytes</code> to <code class="literal">uncompressed-bytes</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">recovery-xid</code> — transaction ID at the backup end time.
        </p></li><li class="listitem"><p>
          <code class="literal">parent-backup-id</code> — ID of the parent backup. Available only
          for incremental backups.
        </p></li><li class="listitem"><p>
          <code class="literal">primary_conninfo</code> — <span class="application">libpq</span> connection parameters
          used to connect to the <span class="productname">PostgreSQL</span> cluster to take this backup. The
          password is not included.
        </p></li><li class="listitem"><p>
          <code class="literal">note</code> — text note attached to backup.
        </p></li><li class="listitem"><p>
          <code class="literal">content-crc</code> — CRC32 checksum of <code class="literal">backup_content.control</code> file.
          It is used to detect corruption of backup metainformation.
        </p></li></ul></div><p>
      </p><p>
        You can also get the detailed information about the backup
        in the <acronym class="acronym">JSON</acronym> format:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --format=json -i backup_id
</pre><p>
        The sample output is as follows:
      </p><pre class="programlisting">
[
  {
      "instance": "node",
      "backups": [
          {
              "id": "PT91HZ",
              "parent-backup-id": "PT8XFX",
              "backup-mode": "DELTA",
              "wal": "ARCHIVE",
              "compress-alg": "zlib",
              "compress-level": 1,
              "from-replica": false,
              "block-size": 8192,
              "xlog-block-size": 8192,
              "checksum-version": 1,
              "program-version": "2.1.3",
              "server-version": "10",
              "current-tli": 16,
              "parent-tli": 2,
              "start-lsn": "0/8000028",
              "stop-lsn": "0/8000160",
              "start-time": "2019-06-17 18:25:11+03",
              "end-time": "2019-06-17 18:25:16+03",
              "recovery-xid": 0,
              "recovery-time": "2019-06-17 18:25:15+03",
              "data-bytes": 106733,
              "wal-bytes": 16777216,
              "primary_conninfo": "user=backup passfile=/var/lib/pgsql/.pgpass port=5432 sslmode=disable sslcompression=1 target_session_attrs=any",
              "status": "OK"
          }
      ]
  }
]
</pre></div><div class="refsect3"><a id="pbk-viewing-wal-archive-information"></a><h4>Viewing WAL Archive Information</h4><p>
        To view the information about WAL archive for every instance,
        run the command:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> [--instance <em class="replaceable"><code>instance_name</code></em>] --archive
</pre><p>
        <span class="application">pg_probackup</span> displays the list of all the available WAL files
        grouped by timelines. For example:
      </p><pre class="programlisting">
ARCHIVE INSTANCE 'node'
===================================================================================================================================
 TLI  Parent TLI  Switchpoint  Min Segno                 Max Segno                 N segments  Size    Zratio  N backups  Status
===================================================================================================================================
 5    1           0/B000000    00000005000000000000000B  00000005000000000000000C  2           685kB   48.00   0          OK
 4    3           0/18000000   000000040000000000000018  00000004000000000000001A  3           648kB   77.00   0          OK
 3    2           0/15000000   000000030000000000000015  000000030000000000000017  3           648kB   77.00   0          OK
 2    1           0/B000108    00000002000000000000000B  000000020000000000000015  5           892kB   94.00   1          DEGRADED
 1    0           0/0          000000010000000000000001  00000001000000000000000A  10          8774kB  19.00   1          OK
</pre><p>
        For each timeline, the following information is provided:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">TLI</code> — timeline identifier.
          </p></li><li class="listitem"><p>
            <code class="literal">Parent TLI</code> — identifier of the timeline from which this timeline branched off.
          </p></li><li class="listitem"><p>
            <code class="literal">Switchpoint</code> — LSN of the moment when the timeline branched
            off from its parent timeline.
          </p></li><li class="listitem"><p>
            <code class="literal">Min Segno</code> — the first WAL segment
            belonging to the timeline.
          </p></li><li class="listitem"><p>
            <code class="literal">Max Segno</code> — the last WAL segment
            belonging to the timeline.
          </p></li><li class="listitem"><p>
            <code class="literal">N segments</code> — number of WAL segments belonging to the
            timeline.
          </p></li><li class="listitem"><p>
            <code class="literal">Size</code> — the size that files take on disk.
          </p></li><li class="listitem"><p>
            <code class="literal">Zratio</code> — compression ratio calculated as <code class="literal">N segments</code> *
            <em class="parameter"><code>wal_segment_size</code></em> * <em class="parameter"><code>wal_block_size</code></em> / <code class="literal">Size</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">N backups</code> — number of backups belonging to the timeline.
            To get the details about backups, use the <acronym class="acronym">JSON</acronym> format.
          </p></li><li class="listitem"><p>
            <code class="literal">Status</code> — status of the WAL archive for this timeline. Possible
            values:
          </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">OK</code> — all WAL segments between <code class="literal">Min Segno</code>
                and <code class="literal">Max Segno</code> are present.
              </p></li><li class="listitem"><p>
                <code class="literal">DEGRADED</code> — some WAL segments between <code class="literal">Min Segno</code>
                and <code class="literal">Max Segno</code> are missing. To find out which files are lost,
                view this report in the <acronym class="acronym">JSON</acronym> format.
              </p></li></ul></div></li></ul></div><p>
        To get more detailed information about the WAL archive in the <acronym class="acronym">JSON</acronym>
        format, run the command:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> [--instance <em class="replaceable"><code>instance_name</code></em>] --archive --format=json
</pre><p>
        The sample output is as follows:
      </p><pre class="programlisting">
[
  {
      "instance": "replica",
      "timelines": [
          {
              "tli": 5,
              "parent-tli": 1,
              "switchpoint": "0/B000000",
              "min-segno": "00000005000000000000000B",
              "max-segno": "00000005000000000000000C",
              "n-segments": 2,
              "size": 685320,
              "zratio": 48.00,
              "closest-backup-id": "PXS92O",
              "status": "OK",
              "lost-segments": [],
              "backups": []
          },
          {
              "tli": 4,
              "parent-tli": 3,
              "switchpoint": "0/18000000",
              "min-segno": "000000040000000000000018",
              "max-segno": "00000004000000000000001A",
              "n-segments": 3,
              "size": 648625,
              "zratio": 77.00,
              "closest-backup-id": "PXS9CE",
              "status": "OK",
              "lost-segments": [],
              "backups": []
          },
          {
              "tli": 3,
              "parent-tli": 2,
              "switchpoint": "0/15000000",
              "min-segno": "000000030000000000000015",
              "max-segno": "000000030000000000000017",
              "n-segments": 3,
              "size": 648911,
              "zratio": 77.00,
              "closest-backup-id": "PXS9CE",
              "status": "OK",
              "lost-segments": [],
              "backups": []
          },
          {
              "tli": 2,
              "parent-tli": 1,
              "switchpoint": "0/B000108",
              "min-segno": "00000002000000000000000B",
              "max-segno": "000000020000000000000015",
              "n-segments": 5,
              "size": 892173,
              "zratio": 94.00,
              "closest-backup-id": "PXS92O",
              "status": "DEGRADED",
              "lost-segments": [
                  {
                      "begin-segno": "00000002000000000000000D",
                      "end-segno": "00000002000000000000000E"
                  },
                  {
                      "begin-segno": "000000020000000000000010",
                      "end-segno": "000000020000000000000012"
                  }
              ],
              "backups": [
                  {
                      "id": "PXS9CE",
                      "backup-mode": "FULL",
                      "wal": "ARCHIVE",
                      "compress-alg": "none",
                      "compress-level": 1,
                      "from-replica": "false",
                      "block-size": 8192,
                      "xlog-block-size": 8192,
                      "checksum-version": 1,
                      "program-version": "2.1.5",
                      "server-version": "10",
                      "current-tli": 2,
                      "parent-tli": 0,
                      "start-lsn": "0/C000028",
                      "stop-lsn": "0/C000160",
                      "start-time": "2019-09-13 21:43:26+03",
                      "end-time": "2019-09-13 21:43:30+03",
                      "recovery-xid": 0,
                      "recovery-time": "2019-09-13 21:43:29+03",
                      "data-bytes": 104674852,
                      "wal-bytes": 16777216,
                      "primary_conninfo": "user=backup passfile=/var/lib/pgsql/.pgpass port=5432 sslmode=disable sslcompression=1 target_session_attrs=any",
                      "status": "OK"
                  }
              ]
          },
          {
              "tli": 1,
              "parent-tli": 0,
              "switchpoint": "0/0",
              "min-segno": "000000010000000000000001",
              "max-segno": "00000001000000000000000A",
              "n-segments": 10,
              "size": 8774805,
              "zratio": 19.00,
              "closest-backup-id": "",
              "status": "OK",
              "lost-segments": [],
              "backups": [
                  {
                      "id": "PXS92O",
                      "backup-mode": "FULL",
                      "wal": "ARCHIVE",
                      "compress-alg": "none",
                      "compress-level": 1,
                      "from-replica": "true",
                      "block-size": 8192,
                      "xlog-block-size": 8192,
                      "checksum-version": 1,
                      "program-version": "2.1.5",
                      "server-version": "10",
                      "current-tli": 1,
                      "parent-tli": 0,
                      "start-lsn": "0/4000028",
                      "stop-lsn": "0/6000028",
                      "start-time": "2019-09-13 21:37:36+03",
                      "end-time": "2019-09-13 21:38:45+03",
                      "recovery-xid": 0,
                      "recovery-time": "2019-09-13 21:37:30+03",
                      "data-bytes": 25987319,
                      "wal-bytes": 50331648,
                      "primary_conninfo": "user=backup passfile=/var/lib/pgsql/.pgpass port=5432 sslmode=disable sslcompression=1 target_session_attrs=any",
                      "status": "OK"
                  }
              ]
          }
      ]
  },
  {
      "instance": "master",
      "timelines": [
          {
              "tli": 1,
              "parent-tli": 0,
              "switchpoint": "0/0",
              "min-segno": "000000010000000000000001",
              "max-segno": "00000001000000000000000B",
              "n-segments": 11,
              "size": 8860892,
              "zratio": 20.00,
              "status": "OK",
              "lost-segments": [],
              "backups": [
                  {
                      "id": "PXS92H",
                      "parent-backup-id": "PXS92C",
                      "backup-mode": "PAGE",
                      "wal": "ARCHIVE",
                      "compress-alg": "none",
                      "compress-level": 1,
                      "from-replica": "false",
                      "block-size": 8192,
                      "xlog-block-size": 8192,
                      "checksum-version": 1,
                      "program-version": "2.1.5",
                      "server-version": "10",
                      "current-tli": 1,
                      "parent-tli": 1,
                      "start-lsn": "0/4000028",
                      "stop-lsn": "0/50000B8",
                      "start-time": "2019-09-13 21:37:29+03",
                      "end-time": "2019-09-13 21:37:31+03",
                      "recovery-xid": 0,
                      "recovery-time": "2019-09-13 21:37:30+03",
                      "data-bytes": 1328461,
                      "wal-bytes": 33554432,
                      "primary_conninfo": "user=backup passfile=/var/lib/pgsql/.pgpass port=5432 sslmode=disable sslcompression=1 target_session_attrs=any",
                      "status": "OK"
                  },
                  {
                      "id": "PXS92C",
                      "backup-mode": "FULL",
                      "wal": "ARCHIVE",
                      "compress-alg": "none",
                      "compress-level": 1,
                      "from-replica": "false",
                      "block-size": 8192,
                      "xlog-block-size": 8192,
                      "checksum-version": 1,
                      "program-version": "2.1.5",
                      "server-version": "10",
                      "current-tli": 1,
                      "parent-tli": 0,
                      "start-lsn": "0/2000028",
                      "stop-lsn": "0/2000160",
                      "start-time": "2019-09-13 21:37:24+03",
                      "end-time": "2019-09-13 21:37:29+03",
                      "recovery-xid": 0,
                      "recovery-time": "2019-09-13 21:37:28+03",
                      "data-bytes": 24871902,
                      "wal-bytes": 16777216,
                      "primary_conninfo": "user=backup passfile=/var/lib/pgsql/.pgpass port=5432 sslmode=disable sslcompression=1 target_session_attrs=any",
                      "status": "OK"
                  }
              ]
          }
      ]
  }
]
</pre><p>
        Most fields are consistent with the plain format, with some
        exceptions:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            The size is in bytes.
          </p></li><li class="listitem"><p>
            The <em class="structfield"><code>closest-backup-id</code></em> attribute
            contains the ID of the most recent valid backup that belongs to
            one of the previous timelines. You can use this backup to perform
            point-in-time recovery to this timeline. If
            such a backup does not exist, this string is empty.
          </p></li><li class="listitem"><p>
            The <em class="structfield"><code>lost-segments</code></em> array provides with
            information about intervals of missing segments in <code class="literal">DEGRADED</code> timelines. In <code class="literal">OK</code>
            timelines, the <em class="structfield"><code>lost-segments</code></em> array is empty.
          </p></li><li class="listitem"><p>
            The <em class="structfield"><code>backups</code></em> array lists all backups
            belonging to the timeline. If the timeline has no backups, this array is empty.
          </p></li></ul></div></div></div><div class="refsect2"><a id="pbk-configuring-retention-policy"></a><h3>Configuring Retention Policy</h3><p>
      With <span class="application">pg_probackup</span>, you can configure
      retention policy to remove redundant backups, clean up unneeded
      WAL files, as well as pin specific backups to ensure they are
      kept for the specified time, as explained in the sections below.
      All these actions can be combined together in any way.
    </p><div class="refsect3"><a id="pbk-retention-policy"></a><h4>Removing Redundant Backups</h4><p>
        By default, all backup copies created with <span class="application">pg_probackup</span> are
        stored in the specified backup catalog. To save disk space,
        you can configure retention policy to remove redundant backup copies.
      </p><p>
        To configure retention policy, set one or more of the
        following variables in the <code class="filename">pg_probackup.conf</code> file via
        <a class="xref" href="#pbk-set-config" title="set-config">set-config</a>:
      </p><pre class="programlisting">
--retention-redundancy=<em class="replaceable"><code>redundancy</code></em>
</pre><p>
        Specifies <span class="strong"><strong>the number of full backup
        copies</strong></span> to keep in the backup catalog.
      </p><pre class="programlisting">
--retention-window=<em class="replaceable"><code>window</code></em>
</pre><p>
        Defines the earliest point in time for which <span class="application">pg_probackup</span> can
        complete the recovery. This option is set in
        <span class="strong"><strong>the number of days</strong></span> from the
        current moment. For example, if
        <code class="literal">retention-window=7</code>, <span class="application">pg_probackup</span> must
        keep at least one backup copy that is older than seven days, with
        all the corresponding WAL files, and all the backups that follow.
      </p><p>
        If both <code class="option">--retention-redundancy</code> and
        <code class="option">--retention-window</code> options are set, both these
        conditions have to be taken into account when purging the backup
        catalog. For example, if you set <code class="literal">--retention-redundancy=2</code>
        and <code class="literal">--retention-window=7</code>,
        <span class="application">pg_probackup</span> has to keep two full backup
        copies, as well as all the backups required to ensure recoverability
        for the last seven days:
      </p><pre class="programlisting">
pg_probackup set-config -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --retention-redundancy=2 --retention-window=7
</pre><p>
        To clean up the backup catalog in accordance with retention policy,
        you have to run the <a class="xref" href="#pbk-delete" title="delete">delete</a> command with
        <a class="link" href="#pbk-retention-opts" title="Retention Options">retention flags</a>, as shown
        below, or use the <a class="xref" href="#pbk-backup" title="backup">backup</a> command with
        these flags to process the outdated backup copies right when the new
        backup is created.
      </p><p>
        For example, to remove all backup copies that no longer satisfy the
        defined retention policy, run the following command with the
        <code class="literal">--delete-expired</code> flag:
      </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --delete-expired
</pre><p>
        If you would like to also remove the WAL files that are no
        longer required for any of the backups, you should also specify the
        <code class="option">--delete-wal</code> flag:
      </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --delete-expired --delete-wal
</pre><p>
        You can also set or override the current retention policy by
        specifying <code class="option">--retention-redundancy</code> and
        <code class="option">--retention-window</code> options directly when
        running <span class="command"><strong>delete</strong></span> or <span class="command"><strong>backup</strong></span>
        commands:
      </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --delete-expired --retention-window=7 --retention-redundancy=2
</pre><p>
        Since incremental backups require that their parent full
        backup and all the preceding incremental backups are
        available, if any of such backups expire, they still cannot be
        removed while at least one incremental backup in this chain
        satisfies the retention policy. To avoid keeping expired
        backups that are still required to restore an active
        incremental one, you can merge them with this backup using the
        <code class="option">--merge-expired</code> flag when running
        <a class="xref" href="#pbk-backup" title="backup">backup</a> or
        <a class="xref" href="#pbk-delete" title="delete">delete</a> commands.
      </p><p>
        Suppose you have backed up the <em class="replaceable"><code>node</code></em>
        instance in the <em class="replaceable"><code>backup_dir</code></em> directory,
        with the <code class="option">--retention-window</code> option set
        to <code class="literal">7</code>, and you have the following backups
        available on April 10, 2019:
      </p><pre class="programlisting">
BACKUP INSTANCE 'node'
===================================================================================================================================
 Instance  Version  ID      Recovery time           Mode   WAL     TLI  Time    Data   WAL  Zratio  Start LSN   Stop LSN    Status
===================================================================================================================================
 node      10       P7XDHR  2019-04-10 05:27:15+03  FULL   STREAM  1/0   11s   200MB  16MB     1.0  0/18000059  0/18000197  OK
 node      10       P7XDQV  2019-04-08 05:32:59+03  PAGE   STREAM  1/0   11s    19MB  16MB     1.0  0/15000060  0/15000198  OK
 node      10       P7XDJA  2019-04-03 05:28:36+03  DELTA  STREAM  1/0   21s    32MB  16MB     1.0  0/13000028  0/13000198  OK
 -------------------------------------------------------retention window--------------------------------------------------------
 node      10       P7XDHU  2019-04-02 05:27:59+03  PAGE   STREAM  1/0   31s    33MB  16MB     1.0  0/11000028  0/110001D0  OK
 node      10       P7XDHB  2019-04-01 05:27:15+03  FULL   STREAM  1/0   11s   200MB  16MB     1.0  0/F000028   0/F000198   OK
 node      10       P7XDFT  2019-03-29 05:26:25+03  FULL   STREAM  1/0   11s   200MB  16MB     1.0  0/D000028   0/D000198   OK
</pre><p>
        Even though <code class="literal">P7XDHB</code> and <code class="literal">P7XDHU</code> backups are outside the
        retention window, they cannot be removed as it invalidates the
        succeeding incremental backups <code class="literal">P7XDJA</code> and <code class="literal">P7XDQV</code> that are
        still required, so, if you run the
        <a class="xref" href="#pbk-delete" title="delete">delete</a> command with the
        <code class="option">--delete-expired</code> flag, only the <code class="literal">P7XDFT</code> full
        backup will be removed.
      </p><p>
        With the <code class="option">--merge-expired</code> option, the <code class="literal">P7XDJA</code>
        backup is merged with the underlying <code class="literal">P7XDHU</code> and <code class="literal">P7XDHB</code> backups
        and becomes a full one, so there is no need to keep these
        expired backups anymore:
      </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>node</code></em> --delete-expired --merge-expired
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em>
</pre><pre class="programlisting">
BACKUP INSTANCE 'node'
==================================================================================================================================
 Instance  Version  ID      Recovery time           Mode  WAL     TLI  Time    Data   WAL  Zratio  Start LSN   Stop LSN    Status
==================================================================================================================================
 node      10       P7XDHR  2019-04-10 05:27:15+03  FULL  STREAM  1/0   11s   200MB  16MB     1.0  0/18000059  0/18000197  OK
 node      10       P7XDQV  2019-04-08 05:32:59+03  PAGE  STREAM  1/0   11s    19MB  16MB     1.0  0/15000060  0/15000198  OK
 node      10       P7XDJA  2019-04-03 05:28:36+03  FULL  STREAM  1/0   21s    32MB  16MB     1.0  0/13000028  0/13000198  OK
</pre><p>
          The <code class="literal">Time</code> field for the merged backup displays the time
          required for the merge.
        </p></div><div class="refsect3"><a id="pbk-backup-pinning"></a><h4>Pinning Backups</h4><p>
        If you need to keep certain backups longer than the
        established retention policy allows, you can pin them
        for arbitrary time. For example:
      </p><pre class="programlisting">
pg_probackup set-backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em> --ttl=30d
</pre><p>
        This command sets the expiration time of the
        specified backup to 30 days starting from the time
        indicated in its <code class="literal">recovery-time</code> attribute.
      </p><p>
        You can also explicitly set the expiration time for a backup
        using the <code class="option">--expire-time</code> option. For example:
      </p><pre class="programlisting">
pg_probackup set-backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em> --expire-time='2020-01-01 00:00:00+03'
</pre><p>
        Alternatively, you can use the <code class="option">--ttl</code> and
        <code class="option">--expire-time</code> options with the
        <a class="xref" href="#pbk-backup" title="backup">backup</a> command to pin the newly
        created backup:
      </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL --ttl=30d
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -b FULL --expire-time='2020-01-01 00:00:00+03'
</pre><p>
        To check if the backup is pinned,
        run the <a class="xref" href="#pbk-show" title="show">show</a> command:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
</pre><p>
      </p><p>
        If the backup is pinned, it has the <code class="literal">expire-time</code>
        attribute that displays its expiration time:
      </p><pre class="programlisting">
...
recovery-time = '2017-05-16 12:57:31'
expire-time = '2020-01-01 00:00:00+03'
data-bytes = 22288792
...
</pre><p>
      </p><p>
        You can unpin the backup by setting the <code class="option">--ttl</code> option to zero:
      </p><pre class="programlisting">
pg_probackup set-backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em> --ttl=0
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          A pinned incremental backup implicitly pins all
          its parent backups. If you unpin such a backup later,
          its implicitly pinned parents will also be automatically unpinned.
        </p></div></div><div class="refsect3"><a id="pbk-wal-archive-retention-policy"></a><h4>Configuring WAL Archive Retention Policy</h4><p>
        When <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
        WAL archiving</a> is enabled, archived WAL segments can take a lot
        of disk space. Even if you delete old backup copies from time to time,
        the <code class="literal">--delete-wal</code> flag can
        purge only those WAL segments that do not apply to any of the
        remaining backups in the backup catalog. However, if point-in-time
        recovery is critical only for the most recent backups, you can
        configure WAL archive retention policy to keep WAL archive of
        limited depth and win back some more disk space.
      </p><p>
        To configure WAL archive retention policy, you have to run the
        <a class="xref" href="#pbk-set-config" title="set-config">set-config</a> command with the
        <code class="literal">--wal-depth</code> option that specifies the number
        of backups that can be used for PITR.
        This setting applies to all the timelines, so you should be able to perform
        PITR for the same number of backups on each timeline, if available.
        <a class="link" href="#pbk-backup-pinning" title="Pinning Backups">Pinned backups</a> are
        not included into this count: if one of the latest backups
        is pinned, <span class="application">pg_probackup</span> ensures that
        PITR is possible for one extra backup.
      </p><p>
       To remove WAL segments that do not satisfy the defined WAL archive
       retention policy, you simply have to run the <a class="xref" href="#pbk-delete" title="delete">delete</a>
       or <a class="xref" href="#pbk-backup" title="backup">backup</a> command with the <code class="literal">--delete-wal</code>
       flag. For archive backups, WAL segments between <code class="literal">Start LSN</code>
       and <code class="literal">Stop LSN</code> are always kept intact, so such backups
       remain valid regardless of the <code class="literal">--wal-depth</code> setting
       and can still be restored, if required.
      </p><p>
        You can also use the <code class="option">--wal-depth</code> option
        with the <a class="xref" href="#pbk-delete" title="delete">delete</a> and <a class="xref" href="#pbk-backup" title="backup">backup</a>
        commands to override the previously defined WAL archive retention
        policy and purge old WAL segments on the fly.
      </p><p>
        Suppose you have backed up the <code class="literal">node</code>
        instance in the <em class="replaceable"><code>backup_dir</code></em> directory and
        configured
        <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous WAL
        archiving</a>:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>node</code></em>
</pre><pre class="programlisting">
BACKUP INSTANCE 'node'
====================================================================================================================================
 Instance  Version  ID      Recovery Time           Mode   WAL Mode  TLI  Time   Data   WAL  Zratio  Start LSN   Stop LSN    Status
====================================================================================================================================
 node      11       PZ9442  2019-10-12 10:43:21+03  DELTA  STREAM    1/0   10s  121kB  16MB    1.00  0/46000028  0/46000160  OK
 node      11       PZ943L  2019-10-12 10:43:04+03  FULL   STREAM    1/0   10s  180MB  32MB    1.00  0/44000028  0/44000160  OK
 node      11       PZ7YR5  2019-10-11 19:49:56+03  DELTA  STREAM    1/1   10s  112kB  32MB    1.00  0/41000028  0/41000160  OK
 node      11       PZ7YMP  2019-10-11 19:47:16+03  DELTA  STREAM    1/1   10s  376kB  32MB    1.00  0/3E000028  0/3F0000B8  OK
 node      11       PZ7YK2  2019-10-11 19:45:45+03  FULL   STREAM    1/0   11s  180MB  16MB    1.00  0/3C000028  0/3C000198  OK
 node      11       PZ7YFO  2019-10-11 19:43:04+03  FULL   STREAM    1/0   10s   30MB  16MB    1.00  0/2000028   0/200ADD8   OK
</pre><p>
        You can check the state of the WAL archive by running the
        <a class="xref" href="#pbk-show" title="show">show</a> command with the
        <code class="option">--archive</code> flag:
      </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> --instance node --archive
</pre><pre class="programlisting">
ARCHIVE INSTANCE 'node'
===============================================================================================================================
 TLI  Parent TLI  Switchpoint  Min Segno                 Max Segno                 N segments  Size  Zratio  N backups  Status
===============================================================================================================================
 1    0           0/0          000000010000000000000001  000000010000000000000047  71          36MB  31.00   6          OK
</pre><p>
        WAL purge without <code class="option">--wal-depth</code> cannot
        achieve much, only one segment is removed:
      </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance node --delete-wal
</pre><pre class="programlisting">
ARCHIVE INSTANCE 'node'
===============================================================================================================================
 TLI  Parent TLI  Switchpoint  Min Segno                 Max Segno                 N segments  Size  Zratio  N backups  Status
===============================================================================================================================
 1    0           0/0          000000010000000000000002  000000010000000000000047  70          34MB  32.00   6          OK
</pre><p>
        If you would like, for example, to keep only those WAL
        segments that can be applied to the latest valid backup, set the
        <code class="option">--wal-depth</code> option to 1:
      </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance node --delete-wal --wal-depth=1
</pre><pre class="programlisting">
ARCHIVE INSTANCE 'node'
================================================================================================================================
 TLI  Parent TLI  Switchpoint  Min Segno                 Max Segno                 N segments  Size   Zratio  N backups  Status
================================================================================================================================
 1    0           0/0          000000010000000000000046  000000010000000000000047  2           143kB  228.00  6          OK
</pre><p>
        Alternatively, you can use the <code class="option">--wal-depth</code>
        option with the <a class="xref" href="#pbk-backup" title="backup">backup</a> command:
      </p><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> --instance node -b DELTA --wal-depth=1 --delete-wal
</pre><pre class="programlisting">
ARCHIVE INSTANCE 'node'
===============================================================================================================================
 TLI  Parent TLI  Switchpoint  Min Segno                 Max Segno                 N segments  Size  Zratio  N backups  Status
===============================================================================================================================
 1    0           0/0          000000010000000000000048  000000010000000000000049  1           72kB  228.00  7          OK
</pre></div></div><div class="refsect2"><a id="pbk-merging-backups"></a><h3>Merging Backups</h3><p>
      As you take more and more incremental backups, the total size of
      the backup catalog can substantially grow. To save disk space,
      you can merge incremental backups to their parent full backup by
      running the <span class="command"><strong>merge</strong></span> command, specifying the backup ID of the most
      recent incremental backup you would like to merge:
    </p><pre class="programlisting">
pg_probackup merge -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
</pre><p>
      This command merges backups that belong to a common incremental backup
      chain. If you specify a full backup, it will be merged with its first
      incremental backup. If you specify an incremental backup, it will be
      merged to its parent full backup, together with all incremental backups
      between them. Once the merge is complete, the full backup takes in all
      the merged data, and the incremental backups are removed as redundant.
      Thus, the merge operation is virtually equivalent to retaking a full
      backup and removing all the outdated backups, but it allows to save much
      time, especially for large data volumes, as well as I/O and network
      traffic if you are using <span class="application">pg_probackup</span> in the
      <a class="link" href="#pbk-remote-backup" title="Using pg_probackup in the Remote Mode">remote</a> mode.
    </p><p>
      Before the merge, <span class="application">pg_probackup</span> validates all the affected
      backups to ensure that they are valid. You can check the current
      backup status by running the <a class="xref" href="#pbk-show" title="show">show</a>
      command with the backup ID:
    </p><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
</pre><p>
      If the merge is still in progress, the backup status is
      displayed as <code class="literal">MERGING</code>. For full backups,
      it can also be shown as <code class="literal">MERGED</code> while the
      metadata is being updated at the final stage of the merge.
      The merge is idempotent, so you can
      restart the merge if it was interrupted.
    </p></div><div class="refsect2"><a id="pbk-deleting-backups"></a><h3>Deleting Backups</h3><p>
      To delete a backup that is no longer required, run the following
      command:
    </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
</pre><p>
      This command will delete the backup with the specified
      <em class="replaceable"><code>backup_id</code></em>, together with all the
      incremental backups that descend from
      <em class="replaceable"><code>backup_id</code></em>, if any. This way you can delete
      some recent incremental backups, retaining the underlying full
      backup and some of the incremental backups that follow it.
    </p><p>
      To delete obsolete WAL files that are not necessary to restore
      any of the remaining backups, use the
      <code class="option">--delete-wal</code> flag:
    </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --delete-wal
</pre><p>
      To delete backups that are expired according to the current
      retention policy, use the <code class="option">--delete-expired</code>
      flag:
    </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --delete-expired
</pre><p>
      Expired backups cannot be removed while at least one
      incremental backup that satisfies the retention policy is based
      on them. If you would like to minimize the number of backups
      still required to keep incremental backups valid, specify the
      <code class="option">--merge-expired</code> flag when running this
      command:
    </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --delete-expired --merge-expired
</pre><p>
      In this case, <span class="application">pg_probackup</span> searches for the oldest incremental
      backup that satisfies the retention policy and merges this
      backup with the underlying full and incremental backups that
      have already expired, thus making it a full backup. Once the
      merge is complete, the remaining expired backups are deleted.
    </p><p>
      Before merging or deleting backups, you can run the
      <span class="command"><strong>delete</strong></span> command with the
      <code class="option">--dry-run</code> flag, which displays the status of
      all the available backups according to the current retention
      policy, without performing any irreversible actions.
    </p><p>
      To delete all backups with specific status, use the <code class="option">--status</code>:
    </p><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --status=ERROR
    </pre><p>
      Deleting backups by status ignores established retention policies.
    </p></div></div><div class="refsect1"><a id="pbk-reference"></a><h2>Command-Line Reference</h2><div class="refsect2"><a id="pbk-commands"></a><h3>Commands</h3><p>
      This section describes <span class="application">pg_probackup</span> commands.
      Optional parameters are enclosed in square brackets. For detailed
      parameter descriptions, see the section <a class="link" href="#pbk-options" title="Options">Options</a>.
    </p><div class="refsect3"><a id="pbk-version"></a><h4>version</h4><pre class="programlisting">
pg_probackup version
</pre><p>
        Prints <span class="application">pg_probackup</span> version.
      </p></div><div class="refsect3"><a id="pbk-help"></a><h4>help</h4><pre class="programlisting">
pg_probackup help [<em class="replaceable"><code>command</code></em>]
</pre><p>
        Displays the synopsis of <span class="application">pg_probackup</span> commands. If one of the
        <span class="application">pg_probackup</span> commands is specified, shows detailed information
        about the options that can be used with this command.
      </p></div><div class="refsect3"><a id="pbk-init"></a><h4>init</h4><pre class="programlisting">
pg_probackup init -B <em class="replaceable"><code>backup_dir</code></em> [--help]
</pre><p>
        Initializes the backup catalog in
        <em class="replaceable"><code>backup_dir</code></em> that will store backup copies,
        WAL archive, and meta information for the backed up database
        clusters. If the specified <em class="replaceable"><code>backup_dir</code></em>
        already exists, it must be empty. Otherwise, <span class="application">pg_probackup</span>
        displays a corresponding error message.
      </p><p>
        For details, see the section
        <a class="link" href="#pbk-initializing-the-backup-catalog" title="Initializing the Backup Catalog">Initializing
        the Backup Catalog</a>.
      </p></div><div class="refsect3"><a id="pbk-add-instance"></a><h4>add-instance</h4><pre class="programlisting">
pg_probackup add-instance -B <em class="replaceable"><code>backup_dir</code></em> -D <em class="replaceable"><code>data_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> [--help]
</pre><p>
        Initializes a new backup instance inside the backup catalog
        <em class="replaceable"><code>backup_dir</code></em> and generates the
        <code class="filename">pg_probackup.conf</code> configuration file that controls
        <span class="application">pg_probackup</span> settings for the cluster with the specified
        <em class="replaceable"><code>data_dir</code></em> data directory.
      </p><p>
        For details, see the section
        <a class="link" href="#pbk-adding-new-backup-instance" title="Adding a New Backup Instance">Adding a New
        Backup Instance</a>.
      </p></div><div class="refsect3"><a id="pbk-del-instance"></a><h4>del-instance</h4><pre class="programlisting">
pg_probackup del-instance -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> [--help]
</pre><p>
        Deletes all backups and WAL files associated with the
        specified instance.
      </p></div><div class="refsect3"><a id="pbk-set-config"></a><h4>set-config</h4><pre class="programlisting">
pg_probackup set-config -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em>
[--help] [--pgdata=<em class="replaceable"><code>pgdata-path</code></em>]
[--retention-redundancy=<em class="replaceable"><code>redundancy</code></em>][--retention-window=<em class="replaceable"><code>window</code></em>][--wal-depth=<em class="replaceable"><code>wal_depth</code></em>]
[--compress-algorithm=<em class="replaceable"><code>compression_algorithm</code></em>] [--compress-level=<em class="replaceable"><code>compression_level</code></em>]
[-d <em class="replaceable"><code>dbname</code></em>] [-h <em class="replaceable"><code>host</code></em>] [-p <em class="replaceable"><code>port</code></em>] [-U <em class="replaceable"><code>username</code></em>]
[--archive-timeout=<em class="replaceable"><code>timeout</code></em>] [--external-dirs=<em class="replaceable"><code>external_directory_path</code></em>]
[--restore-command=<em class="replaceable"><code>cmdline</code></em>]
[<em class="replaceable"><code>remote_options</code></em>] [<em class="replaceable"><code>remote_wal_archive_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Adds the specified connection, compression, retention, logging,
        and external directory settings into the <code class="filename">pg_probackup.conf</code>
        configuration file, or modifies the previously defined values.
      </p><p>
        For all available settings, see the
        <a class="link" href="#pbk-options" title="Options">Options</a> section.
      </p><p>
        It is <span class="strong"><strong>not recommended</strong></span> to
        edit <code class="filename">pg_probackup.conf</code> manually.
      </p></div><div class="refsect3"><a id="pbk-set-backup"></a><h4>set-backup</h4><pre class="programlisting">
pg_probackup set-backup -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
{--ttl=<em class="replaceable"><code>ttl</code></em> | --expire-time=<em class="replaceable"><code>time</code></em>}
[--note=<em class="replaceable"><code>backup_note</code></em>] [--help]
</pre><p>
        Sets the provided backup-specific settings into the
        <code class="filename">backup.control</code> configuration file, or modifies the previously
        defined values.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--note=<em class="replaceable"><code>backup_note</code></em></code></span></dt><dd><p>
        Sets the text note for backup copy.
        If <em class="replaceable"><code>backup_note</code></em> contain newline characters,
        then only substring before first newline character will be saved.
        Max size of text note is 1 KB.
        The <em class="replaceable"><code>'none'</code></em> value removes current note.
      </p></dd></dl></div><p>
        For all available pinning settings, see the section
        <a class="link" href="#pbk-pinning-options" title="Pinning Options">Pinning Options</a>.
      </p></div><div class="refsect3"><a id="pbk-show-config"></a><h4>show-config</h4><pre class="programlisting">
pg_probackup show-config -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> [--format=plain|json]
</pre><p>
        Displays the contents of the <code class="filename">pg_probackup.conf</code> configuration
        file located in the
        <code class="filename"><em class="replaceable"><code>backup_dir</code></em>/backups/<em class="replaceable"><code>instance_name</code></em></code>
        directory. You can specify the
        <code class="literal">--format=json</code> option to get the result
        in the <acronym class="acronym">JSON</acronym> format. By default, configuration settings are
        shown as plain text.
      </p><p>
        To edit <code class="filename">pg_probackup.conf</code>, use the
        <a class="xref" href="#pbk-set-config" title="set-config">set-config</a> command.
      </p></div><div class="refsect3"><a id="pbk-show"></a><h4>show</h4><pre class="programlisting">
pg_probackup show -B <em class="replaceable"><code>backup_dir</code></em>
[--help] [--instance <em class="replaceable"><code>instance_name</code></em> [-i <em class="replaceable"><code>backup_id</code></em> | --archive]] [--format=plain|json]
</pre><p>
        Shows the contents of the backup catalog. If
        <em class="replaceable"><code>instance_name</code></em> and
        <em class="replaceable"><code>backup_id</code></em> are specified, shows detailed
        information about this backup. If the <code class="option">--archive</code> option is
        specified, shows the contents of WAL archive of the backup
        catalog.
      </p><p>
        By default, the contents of the backup catalog is shown as
        plain text. You can specify the
        <code class="literal">--format=json</code> option to get the result
        in the <acronym class="acronym">JSON</acronym> format.
      </p><p>
        For details on usage, see the sections
        <a class="link" href="#pbk-managing-the-backup-catalog" title="Managing the Backup Catalog">Managing the
        Backup Catalog</a> and
        <a class="link" href="#pbk-viewing-wal-archive-information" title="Viewing WAL Archive Information">Viewing WAL
        Archive Information</a>.
      </p></div><div class="refsect3"><a id="pbk-backup"></a><h4>backup</h4><pre class="programlisting">
pg_probackup backup -B <em class="replaceable"><code>backup_dir</code></em> -b <em class="replaceable"><code>backup_mode</code></em> --instance <em class="replaceable"><code>instance_name</code></em>
[--help] [-j <em class="replaceable"><code>num_threads</code></em>] [--progress]
[-C] [--stream [-S slot_name] [--temp-slot]] [--backup-pg-log]
[--no-validate] [--skip-block-validation]
[-w --no-password] [-W --password]
[--archive-timeout=<em class="replaceable"><code>timeout</code></em>] [--external-dirs=<em class="replaceable"><code>external_directory_path</code></em>]
[--no-sync] [--note=<em class="replaceable"><code>backup_note</code></em>]
[<em class="replaceable"><code>connection_options</code></em>] [<em class="replaceable"><code>compression_options</code></em>] [<em class="replaceable"><code>remote_options</code></em>]
[<em class="replaceable"><code>retention_options</code></em>] [<em class="replaceable"><code>pinning_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Creates a backup copy of the <span class="productname">PostgreSQL</span> instance.

      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-b <em class="replaceable"><code>mode</code></em></code>, </span><span class="term"><code class="option">--backup-mode=<em class="replaceable"><code>mode</code></em></code></span></dt><dd><p>
        Specifies the backup mode to use. Possible values are:

      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">FULL</code> — creates a full backup that contains all the data
            files of the cluster to be restored.
          </p></li><li class="listitem"><p>
            <code class="literal">DELTA</code> — reads all data files in the data directory and
            creates an incremental backup for pages that have changed
            since the previous backup.
          </p></li><li class="listitem"><p>
            <code class="literal">PAGE</code> — creates an incremental PAGE backup based on the WAL
            files that have changed since the previous full or
            incremental backup was taken.
          </p></li><li class="listitem"><p>
            <code class="literal">PTRACK</code> — creates an incremental PTRACK backup tracking
            page changes on the fly.
          </p></li></ul></div><p>
      </p></dd><dt><span class="term"><code class="option">-C</code>, </span><span class="term"><code class="option">--smooth-checkpoint</code></span></dt><dd><p>
        Spreads out the checkpoint over a period of time. By default,
        <span class="application">pg_probackup</span> tries to complete the checkpoint as soon as
        possible.
      </p></dd><dt><span class="term"><code class="option">--stream</code></span></dt><dd><p>
        Makes a <a class="link" href="#pbk-stream-mode" title="STREAM Mode">STREAM</a> backup, which
        includes all the necessary WAL files by streaming them from
        the database server via replication protocol.
      </p></dd><dt><span class="term"><code class="option">--temp-slot</code></span></dt><dd><p>
        Creates a temporary physical replication slot for streaming
        WAL from the backed up <span class="productname">PostgreSQL</span> instance. It ensures that
        all the required WAL segments remain available if WAL is
        rotated while the backup is in progress. This flag can only be
        used together with the <code class="option">--stream</code> flag.
        The default slot name is <code class="literal">pg_probackup_slot</code>,
        which can be changed using the <code class="option">--slot</code>/<code class="option">-S</code> option.
      </p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>slot_name</code></em></code>, </span><span class="term"><code class="option">--slot=<em class="replaceable"><code>slot_name</code></em></code></span></dt><dd><p>
        Specifies the replication slot for WAL streaming. This option
        can only be used together with the <code class="option">--stream</code>
        flag.
      </p></dd><dt><span class="term"><code class="option">--backup-pg-log</code></span></dt><dd><p>
        Includes the log directory into the backup. This directory
        usually contains log messages. By default, log directory is
        excluded.
      </p></dd><dt><span class="term"><code class="option">-E <em class="replaceable"><code>external_directory_path</code></em></code>, </span><span class="term"><code class="option">--external-dirs=<em class="replaceable"><code>external_directory_path</code></em></code></span></dt><dd><p>
        Includes the specified directory into the backup by recursively
        copying its contents into a separate subdirectory in the backup catalog. This option
        is useful to back up scripts, SQL dump files, and configuration
        files located outside of the data directory. If you would like
        to back up several external directories, separate their paths
        by a colon on Unix and a semicolon on Windows.
      </p></dd><dt><span class="term"><code class="option">--archive-timeout=<em class="replaceable"><code>wait_time</code></em></code></span></dt><dd><p>
        Sets the timeout for WAL segment archiving and
        streaming, in seconds. By default, <span class="application">pg_probackup</span> waits 300 seconds.
      </p></dd><dt><span class="term"><code class="option">--skip-block-validation</code></span></dt><dd><p>
        Disables block-level checksum verification to speed up
        the backup process.
      </p></dd><dt><span class="term"><code class="option">--no-validate</code></span></dt><dd><p>
        Skips automatic validation after the backup is taken. You can
        use this flag if you validate backups regularly and would like
        to save time when running backup operations.
      </p></dd><dt><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>
        Do not sync backed up files to disk. You can use this flag to speed
        up the backup process. Using this flag can result in data
        corruption in case of operating system or hardware crash.
        If you use this option, it is recommended to run the
        <a class="xref" href="#pbk-validate" title="validate">validate</a> command once the backup is complete
        to detect possible issues.
      </p></dd><dt><span class="term"><code class="option">--note=<em class="replaceable"><code>backup_note</code></em></code></span></dt><dd><p>
        Sets the text note for backup copy.
        If <em class="replaceable"><code>backup_note</code></em> contain newline characters,
        then only substring before first newline character will be saved.
        Max size of text note is 1 KB.
        The <em class="replaceable"><code>'none'</code></em> value removes current note.
      </p></dd></dl></div><p>
      </p><p>
        Additionally, <a class="link" href="#pbk-connection-opts" title="Connection Options">connection
        options</a>, <a class="link" href="#pbk-retention-opts" title="Retention Options">retention
        options</a>, <a class="link" href="#pbk-pinning-options" title="Pinning Options">pinning
        options</a>, <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote
        mode options</a>,
        <a class="link" href="#pbk-compression-opts" title="Compression Options">compression
        options</a>, <a class="link" href="#pbk-logging-opts" title="Logging Options">logging
        options</a>, and <a class="link" href="#pbk-common-options" title="Common Options">common
        options</a> can be used.
      </p><p>
        For details on usage, see the section
        <a class="link" href="#pbk-creating-backup" title="Creating a Backup">Creating a Backup</a>.
      </p></div><div class="refsect3"><a id="pbk-restore"></a><h4>restore</h4><pre class="programlisting">
pg_probackup restore -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em>
[--help] [-D <em class="replaceable"><code>data_dir</code></em>] [-i <em class="replaceable"><code>backup_id</code></em>]
[-j <em class="replaceable"><code>num_threads</code></em>] [--progress]
[-T <em class="replaceable"><code>OLDDIR</code></em>=<em class="replaceable"><code>NEWDIR</code></em>] [--external-mapping=<em class="replaceable"><code>OLDDIR</code></em>=<em class="replaceable"><code>NEWDIR</code></em>] [--skip-external-dirs]
[-R | --restore-as-replica] [--no-validate] [--skip-block-validation]
[--force] [--no-sync]
[--restore-command=<em class="replaceable"><code>cmdline</code></em>]
[--primary-conninfo=<em class="replaceable"><code>primary_conninfo</code></em>]
[-S | --primary-slot-name=<em class="replaceable"><code>slot_name</code></em>]
[<em class="replaceable"><code>recovery_target_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>] [<em class="replaceable"><code>remote_options</code></em>]
[<em class="replaceable"><code>partial_restore_options</code></em>] [<em class="replaceable"><code>remote_wal_archive_options</code></em>]
</pre><p>
        Restores the <span class="productname">PostgreSQL</span> instance from a backup copy located in
        the <em class="replaceable"><code>backup_dir</code></em> backup catalog. If you
        specify a <a class="link" href="#pbk-recovery-target-opts" title="Recovery Target Options">recovery
        target option</a>, <span class="application">pg_probackup</span> finds the closest
        backup and restores it to the specified recovery target.
        If neither the backup ID nor recovery target options are provided,
        <span class="application">pg_probackup</span> uses the most recent backup
        to perform the recovery.
      </p><p>
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-R</code>, </span><span class="term"><code class="option">--restore-as-replica</code></span></dt><dd><p>
        Creates a minimal recovery configuration file to facilitate setting up a
        standby server. If the replication connection requires a password,
        you must specify the password manually in the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-replication.html#GUC-PRIMARY-CONNINFO" target="_top">primary_conninfo</a>
        parameter as it is not included.
        For <span class="productname">PostgreSQL</span> 11 or lower,
        recovery settings are written into the <code class="filename">recovery.conf</code>
        file. Starting from <span class="productname">PostgreSQL</span> 12,
        <span class="application">pg_probackup</span> writes these settings into
        the <code class="filename">probackup_recovery.conf</code> file in the data
        directory, and then includes them into the
        <code class="filename">postgresql.auto.conf</code> when the cluster is
        is started.
      </p></dd><dt><span class="term"><code class="option">--primary-conninfo=<em class="replaceable"><code>primary_conninfo</code></em></code></span></dt><dd><p>
        Sets the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-replication.html#GUC-PRIMARY-CONNINFO" target="_top">primary_conninfo</a>
        parameter to the specified value.
        This option will be ignored unless the <code class="option">-R</code> flag is specified.
      </p><p>
        Example: <code class="literal">--primary-conninfo='host=192.168.1.50 port=5432 user=foo password=foopass'</code>
      </p></dd><dt><span class="term"><code class="option">-S</code>, </span><span class="term"><code class="option">--primary-slot-name=<em class="replaceable"><code>slot_name</code></em></code></span></dt><dd><p>
        Sets the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-replication.html#GUC-PRIMARY-SLOT-NAME" target="_top">primary_slot_name</a>
        parameter to the specified value.
        This option will be ignored unless the <code class="option">-R</code> flag is specified.
      </p></dd><dt><span class="term"><code class="option">-T <em class="replaceable"><code>OLDDIR</code></em>=<em class="replaceable"><code>NEWDIR</code></em></code>, </span><span class="term"><code class="option">--tablespace-mapping=<em class="replaceable"><code>OLDDIR</code></em>=<em class="replaceable"><code>NEWDIR</code></em></code></span></dt><dd><p>
        Relocates the tablespace from the <em class="replaceable"><code>OLDDIR</code></em> to the <em class="replaceable"><code>NEWDIR</code></em>
        directory at the time of recovery. Both <em class="replaceable"><code>OLDDIR</code></em> and <em class="replaceable"><code>NEWDIR</code></em> must
        be absolute paths. If the path contains the equals sign (<code class="literal">=</code>),
        escape it with a backslash. This option can be specified
        multiple times for multiple tablespaces.
      </p></dd><dt><span class="term"><code class="option">--external-mapping=<em class="replaceable"><code>OLDDIR</code></em>=<em class="replaceable"><code>NEWDIR</code></em></code></span></dt><dd><p>
        Relocates an external directory included into the backup from
        the <em class="replaceable"><code>OLDDIR</code></em> to the <em class="replaceable"><code>NEWDIR</code></em> directory at the time of recovery.
        Both <em class="replaceable"><code>OLDDIR</code></em> and <em class="replaceable"><code>NEWDIR</code></em> must be absolute paths. If the path
        contains the equals sign (<code class="literal">=</code>), escape it with a backslash. This
        option can be specified multiple times for multiple
        directories.
      </p></dd><dt><span class="term"><code class="option">--skip-external-dirs</code></span></dt><dd><p>
        Skip external directories included into the backup with the
        <code class="option">--external-dirs</code> option. The contents of
        these directories will not be restored.
      </p></dd><dt><span class="term"><code class="option">--skip-block-validation</code></span></dt><dd><p>
        Disables block-level checksum verification to speed up
        validation. During automatic validation before the restore only
        file-level checksums will be verified.
      </p></dd><dt><span class="term"><code class="option">--no-validate</code></span></dt><dd><p>
        Skips backup validation. You can use this flag if you validate
        backups regularly and would like to save time when running
        restore operations.
      </p></dd><dt><span class="term"><code class="option">--restore-command=<em class="replaceable"><code>cmdline</code></em></code></span></dt><dd><p>
        Sets the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/archive-recovery-settings.html#RESTORE-COMMAND" target="_top">restore_command</a>
        parameter to the specified command. For example:
        <code class="literal">--restore-command='cp /mnt/server/archivedir/%f "%p"'</code>
      </p></dd><dt><span class="term"><code class="option">--force</code></span></dt><dd><p>
        Allows to ignore an invalid status of the backup. You can use
        this flag if you need to restore the
        <span class="productname">PostgreSQL</span> cluster from a corrupt or an invalid backup.
        Use with caution.
      </p></dd><dt><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>
        Do not sync restored files to disk. You can use this flag to speed
        up restore process. Using this flag can result in data
        corruption in case of operating system or hardware crash.
        If it happens, you have to run the <a class="xref" href="#pbk-restore" title="restore">restore</a>
        command again.
      </p></dd></dl></div><p>
    </p><p>
        Additionally, <a class="link" href="#pbk-recovery-target-opts" title="Recovery Target Options">recovery
        target options</a>,
        <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote mode
        options</a>,
        <a class="link" href="#pbk-remote-wal-archive-options" title="Remote WAL Archive Options">remote WAL archive
        options</a>, <a class="link" href="#pbk-logging-opts" title="Logging Options">logging
        options</a>, <a class="link" href="#pbk-partial-restore" title="Partial Restore">partial
        restore options</a>, and <a class="link" href="#pbk-common-options" title="Common Options">common
        options</a> can be used.
      </p><p>
        For details on usage, see the section
        <a class="link" href="#pbk-restoring-a-cluster" title="Restoring a Cluster">Restoring a
        Cluster</a>.
      </p></div><div class="refsect3"><a id="pbk-checkdb"></a><h4>checkdb</h4><pre class="programlisting">
pg_probackup checkdb
[-B <em class="replaceable"><code>backup_dir</code></em>] [--instance <em class="replaceable"><code>instance_name</code></em>] [-D <em class="replaceable"><code>data_dir</code></em>]
[--help] [-j <em class="replaceable"><code>num_threads</code></em>] [--progress]
[--skip-block-validation] [--amcheck] [--heapallindexed]
[<em class="replaceable"><code>connection_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Verifies the <span class="productname">PostgreSQL</span> database cluster correctness by
        detecting physical and logical corruption.
      </p><p>
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--amcheck</code></span></dt><dd><p>
        Performs logical verification of indexes for the specified
        <span class="productname">PostgreSQL</span> instance if no corruption was found while checking
        data files. You must have the <span class="application">amcheck</span>
        extension or the <span class="application">amcheck_next</span> extension
        installed in the database to check its indexes. For databases
        without <span class="application">amcheck</span>, index verification will be skipped.
      </p></dd><dt><span class="term"><code class="option">--skip-block-validation</code></span></dt><dd><p>
        Skip validation of data files. You can use this flag only
        together with the <code class="option">--amcheck</code> flag, so that only logical
        verification of indexes is performed.
      </p></dd><dt><span class="term"><code class="option">--heapallindexed</code></span></dt><dd><p>
        Checks that all heap tuples that should be indexed are
        actually indexed. You can use this flag only together with the
        <code class="option">--amcheck</code> flag.
      </p><p>
        This check is only possible if you are using the
        <span class="application">amcheck</span> extension of version 2.0 or higher, or
        the <span class="application">amcheck_next</span> extension of any version.
      </p></dd></dl></div><p>
    </p><p>
        Additionally, <a class="link" href="#pbk-connection-opts" title="Connection Options">connection
        options</a> and <a class="link" href="#pbk-logging-opts" title="Logging Options">logging
        options</a> can be used.
      </p><p>
        For details on usage, see the section
        <a class="link" href="#pbk-verifying-a-cluster" title="Performing Cluster Verification">Verifying a
        Cluster</a>.
      </p></div><div class="refsect3"><a id="pbk-validate"></a><h4>validate</h4><pre class="programlisting">
pg_probackup validate -B <em class="replaceable"><code>backup_dir</code></em>
[--help] [--instance <em class="replaceable"><code>instance_name</code></em>] [-i <em class="replaceable"><code>backup_id</code></em>]
[-j <em class="replaceable"><code>num_threads</code></em>] [--progress]
[--skip-block-validation]
[<em class="replaceable"><code>recovery_target_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Verifies that all the files required to restore the cluster
        are present and are not corrupt. If
        <em class="replaceable"><code>instance_name</code></em> is not specified,
        <span class="application">pg_probackup</span> validates all backups available in the backup
        catalog. If you specify the <em class="replaceable"><code>instance_name</code></em>
        without any additional options, <span class="application">pg_probackup</span> validates all the
        backups available for this backup instance. If you specify the
        <em class="replaceable"><code>instance_name</code></em> with a
        <a class="link" href="#pbk-recovery-target-opts" title="Recovery Target Options">recovery target
        option</a> and/or a <em class="replaceable"><code>backup_id</code></em>,
        <span class="application">pg_probackup</span> checks whether it is possible to restore the
        cluster using these options.
      </p><p>
        For details, see the section
        <a class="link" href="#pbk-validating-backups" title="Validating a Backup">Validating a
        Backup</a>.
      </p></div><div class="refsect3"><a id="pbk-merge"></a><h4>merge</h4><pre class="programlisting">
pg_probackup merge -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> -i <em class="replaceable"><code>backup_id</code></em>
[--help] [-j <em class="replaceable"><code>num_threads</code></em>] [--progress]
[<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Merges backups that belong to a common incremental backup
        chain. If you specify a full backup, it will be merged with its first
        incremental backup. If you specify an incremental backup, it will be
        merged to its parent full backup, together with all incremental backups
        between them. Once the merge is complete, the full backup takes in all
        the merged data, and the incremental backups are removed as redundant.
      </p><p>
        For details, see the section
        <a class="link" href="#pbk-merging-backups" title="Merging Backups">Merging Backups</a>.
      </p></div><div class="refsect3"><a id="pbk-delete"></a><h4>delete</h4><pre class="programlisting">
pg_probackup delete -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em>
[--help] [-j <em class="replaceable"><code>num_threads</code></em>] [--progress]
[--retention-redundancy=<em class="replaceable"><code>redundancy</code></em>][--retention-window=<em class="replaceable"><code>window</code></em>][--wal-depth=<em class="replaceable"><code>wal_depth</code></em>] [--delete-wal]
{-i <em class="replaceable"><code>backup_id</code></em> | --delete-expired [--merge-expired] | --merge-expired | --status=backup_status}
[--dry-run] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Deletes backup with specified <em class="replaceable"><code>backup_id</code></em>
        or launches the retention purge of backups and archived WAL
        that do not satisfy the current retention policies.
      </p><p>
        For details, see the sections
        <a class="link" href="#pbk-deleting-backups" title="Deleting Backups">Deleting Backups</a>,
        <a class="link" href="#pbk-retention-opts" title="Retention Options">Retention Options</a> and
        <a class="link" href="#pbk-configuring-retention-policy" title="Configuring Retention Policy">Configuring
        Retention Policy</a>.
      </p></div><div class="refsect3"><a id="pbk-archive-push"></a><h4>archive-push</h4><pre class="programlisting">
pg_probackup archive-push -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em>
--wal-file-name=<em class="replaceable"><code>wal_file_name</code></em> [--wal-file-path=<em class="replaceable"><code>wal_file_path</code></em>]
[--help] [--no-sync] [--compress] [--no-ready-rename] [--overwrite]
[-j <em class="replaceable"><code>num_threads</code></em>] [--batch-size=<em class="replaceable"><code>batch_size</code></em>]
[--archive-timeout=<em class="replaceable"><code>timeout</code></em>]
[--compress-algorithm=<em class="replaceable"><code>compression_algorithm</code></em>]
[--compress-level=<em class="replaceable"><code>compression_level</code></em>]
[<em class="replaceable"><code>remote_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Copies WAL files into the corresponding subdirectory of the
        backup catalog and validates the backup instance by
        <em class="replaceable"><code>instance_name</code></em> and
        <code class="varname">system-identifier</code>. If parameters of the
        backup instance and the cluster do not match, this command
        fails with the following error message: <code class="literal">Refuse to push WAL
        segment segment_name into archive. Instance parameters
        mismatch.</code>
      </p><p>
        If the files to be copied already exists in the backup catalog,
        <span class="application">pg_probackup</span> computes and compares their checksums. If the
        checksums match, <span class="command"><strong>archive-push</strong></span> skips the corresponding file and
        returns a successful execution code. Otherwise, <span class="command"><strong>archive-push</strong></span>
        fails with an error. If you would like to replace WAL files in
        the case of checksum mismatch, run the <span class="command"><strong>archive-push</strong></span> command
        with the <code class="option">--overwrite</code> flag.
      </p><p>
        Each file is copied to a temporary file with the
        <code class="literal">.part</code> suffix. If the temporary file already
        exists, <span class="application">pg_probackup</span> will wait
        <code class="option">archive_timeout</code> seconds before discarding it.
        After the copy is done, atomic rename is performed.
        This algorithm ensures that a failed <span class="command"><strong>archive-push</strong></span>
        will not stall continuous archiving and that concurrent archiving from
        multiple sources into a single WAL archive has no risk of archive
        corruption.
      </p><p>
        To speed up archiving, you can specify the <code class="option">--batch-size</code> option
        to copy WAL segments in batches of the specified size.
        If <code class="option">--batch-size</code> option is used, then you can also specify
        the <code class="option">-j</code> option to copy the batch of WAL segments on multiple threads.
      </p><p>
        WAL segments copied to the archive are synced to disk unless
        the <code class="option">--no-sync</code> flag is used.
      </p><p>
        You can use <span class="command"><strong>archive-push</strong></span> in the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-ARCHIVE-COMMAND" target="_top">archive_command</a>
        <span class="productname">PostgreSQL</span> parameter to set up
        <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
        WAL archiving</a>.
      </p><p>
        For details, see sections
        <a class="link" href="#pbk-archiving-options" title="Archiving Options">Archiving Options</a> and
        <a class="link" href="#pbk-compression-opts" title="Compression Options">Compression
        Options</a>.
      </p></div><div class="refsect3"><a id="pbk-archive-get"></a><h4>archive-get</h4><pre class="programlisting">
pg_probackup archive-get -B <em class="replaceable"><code>backup_dir</code></em> --instance <em class="replaceable"><code>instance_name</code></em> --wal-file-path=<em class="replaceable"><code>wal_file_path</code></em> --wal-file-name=<em class="replaceable"><code>wal_file_name</code></em>
[-j <em class="replaceable"><code>num_threads</code></em>] [--batch-size=<em class="replaceable"><code>batch_size</code></em>]
[--prefetch-dir=<em class="replaceable"><code>prefetch_dir_path</code></em>] [--no-validate-wal]
[--help] [<em class="replaceable"><code>remote_options</code></em>] [<em class="replaceable"><code>logging_options</code></em>]
</pre><p>
        Copies WAL files from the corresponding subdirectory of the
        backup catalog to the cluster's write-ahead log location. This
        command is automatically set by <span class="application">pg_probackup</span> as part of the
        <span class="command"><strong>restore_command</strong></span> when
        restoring backups using a WAL archive. You do not need to set
        it manually.
      </p><p>
        To speed up recovery, you can specify the <code class="option">--batch-size</code> option
        to copy WAL segments in batches of the specified size.
        If <code class="option">--batch-size</code> option is used, then you can also specify
        the <code class="option">-j</code> option to copy the batch of WAL segments on multiple threads.
      </p><p>
        For details, see section <a class="link" href="#pbk-archiving-options" title="Archiving Options">Archiving Options</a>.
      </p></div></div><div class="refsect2"><a id="pbk-options"></a><h3>Options</h3><p>
      This section describes command-line options for <span class="application">pg_probackup</span>
      commands. If the option value can be derived from an environment
      variable, this variable is specified below the command-line
      option, in the uppercase. Some values can be taken from the
      <code class="filename">pg_probackup.conf</code> configuration file located in the backup
      catalog.
    </p><p>
      For details, see <a class="xref" href="#pbk-configuring-pg-probackup" title="Configuring pg_probackup">the section called “Configuring <span class="application">pg_probackup</span>”</a>.
    </p><p>
      If an option is specified using more than one method,
      command-line input has the highest priority, while the
      <code class="filename">pg_probackup.conf</code> settings have the lowest priority.
    </p><div class="refsect3"><a id="pbk-common-options"></a><h4>Common Options</h4><p>
        The list of general options.
      </p><p>
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-B <em class="replaceable"><code>directory</code></em></code>, </span><span class="term"><code class="option">--backup-path=<em class="replaceable"><code>directory</code></em></code>, </span><span class="term"><code class="envar">BACKUP_PATH</code></span></dt><dd><p>
        Specifies the absolute path to the backup catalog. Backup
        catalog is a directory where all backup files and meta
        information are stored. Since this option is required for most
        of the <span class="application">pg_probackup</span> commands, you are recommended to specify
        it once in the <code class="envar">BACKUP_PATH</code> environment variable. In this case,
        you do not need to use this option each time on the command
        line.
      </p></dd><dt><span class="term"><code class="option">-D <em class="replaceable"><code>directory</code></em></code>, </span><span class="term"><code class="option">--pgdata=<em class="replaceable"><code>directory</code></em></code>, </span><span class="term"><code class="envar">PGDATA</code></span></dt><dd><p>
        Specifies the absolute path to the data directory of the
        database cluster. This option is mandatory only for the
        <a class="xref" href="#pbk-add-instance" title="add-instance">add-instance</a> command.
        Other commands can take its value from the <code class="envar">PGDATA</code> environment
        variable, or from the <code class="filename">pg_probackup.conf</code> configuration file.
      </p></dd><dt><span class="term"><code class="option">-i <em class="replaceable"><code>backup_id</code></em></code>, </span><span class="term"><code class="option">--backup-id=<em class="replaceable"><code>backup_id</code></em></code></span></dt><dd><p>
        Specifies the unique identifier of the backup.
      </p></dd><dt><span class="term"><code class="option">-j <em class="replaceable"><code>num_threads</code></em></code>, </span><span class="term"><code class="option">--threads=<em class="replaceable"><code>num_threads</code></em></code></span></dt><dd><p>
        Sets the number of parallel threads for <span class="command"><strong>backup</strong></span>,
        <span class="command"><strong>restore</strong></span>, <span class="command"><strong>merge</strong></span>,
        <span class="command"><strong>validate</strong></span>, <span class="command"><strong>checkdb</strong></span>, and
        <span class="command"><strong>archive-push</strong></span> processes.
      </p></dd><dt><span class="term"><code class="option">--progress</code></span></dt><dd><p>
        Shows the progress of operations.
      </p></dd><dt><span class="term"><code class="option">--help</code></span></dt><dd><p>
        Shows detailed information about the options that can be used
        with this command.
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-recovery-target-opts"></a><h4>Recovery Target Options</h4><p>
        If
        <a class="link" href="#pbk-setting-up-continuous-wal-archiving" title="Setting up Continuous WAL Archiving">continuous
        WAL archiving</a> is configured, you can use one of these
        options together with <a class="xref" href="#pbk-restore" title="restore">restore</a>
        or <a class="xref" href="#pbk-validate" title="validate">validate</a> commands to
        specify the moment up to which the database cluster must be
        restored or validated.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--recovery-target=immediate|latest</code></span></dt><dd><p>
        Defines when to stop the recovery:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">immediate</code> value stops the recovery
            after reaching the consistent state of the specified
            backup, or the latest available backup if the
            <code class="option">-i</code>/<code class="option">--backup-id</code> option is omitted.
            This is the default behavior for STREAM backups.
          </p></li><li class="listitem"><p>
            The <code class="literal">latest</code> value continues the recovery
            until all WAL segments available in the archive are
            applied. This is the default behavior for ARCHIVE backups.
          </p></li></ul></div><p>
      </p></dd><dt><span class="term"><code class="option">--recovery-target-timeline=<em class="replaceable"><code>timeline</code></em></code></span></dt><dd><p>
        Specifies a particular timeline to be used for recovery.
        By default, the timeline of the specified backup is used.
      </p></dd><dt><span class="term"><code class="option">--recovery-target-lsn=<em class="replaceable"><code>lsn</code></em></code></span></dt><dd><p>
        Specifies the LSN of the write-ahead log location up to which
        recovery will proceed. Can be used only when restoring
        a database cluster of major version 10 or higher.
      </p></dd><dt><span class="term"><code class="option">--recovery-target-name=<em class="replaceable"><code>recovery_target_name</code></em></code></span></dt><dd><p>
        Specifies a named savepoint up to which to restore the cluster.
      </p></dd><dt><span class="term"><code class="option">--recovery-target-time=<em class="replaceable"><code>time</code></em></code></span></dt><dd><p>
        Specifies the timestamp up to which recovery will proceed.
      </p></dd><dt><span class="term"><code class="option">--recovery-target-xid=<em class="replaceable"><code>xid</code></em></code></span></dt><dd><p>
        Specifies the transaction ID up to which recovery will
        proceed.
      </p></dd><dt><span class="term"><code class="option">--recovery-target-inclusive=<em class="replaceable"><code>boolean</code></em></code>, </span><span class="term"><code class="option"></code></span></dt><dd><p>
        Specifies whether to stop just after the specified recovery
        target (<code class="literal">true</code>), or just before the recovery target (<code class="literal">false</code>).
        This option can only be used together with
        <code class="option">--recovery-target-name</code>,
        <code class="option">--recovery-target-time</code>,
        <code class="option">--recovery-target-lsn</code> or
        <code class="option">--recovery-target-xid</code> options. The default
        depends on the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/recovery-target-settings.html#RECOVERY-TARGET-INCLUSIVE" target="_top">recovery_target_inclusive</a>
        parameter.
      </p></dd><dt><span class="term"><code class="option">--recovery-target-action=pause|promote|shutdown</code></span></dt><dd><p>
        Specifies
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/recovery-target-settings.html#RECOVERY-TARGET-ACTION" target="_top">the
        action</a> the server should take when the recovery target
        is reached.
      </p><p>
       Default: <code class="literal">pause</code>
      </p></dd></dl></div><p>
    </p></div><div class="refsect3"><a id="pbk-retention-opts"></a><h4>Retention Options</h4><p>
        You can use these options together with
        <a class="xref" href="#pbk-backup" title="backup">backup</a> and
        <a class="xref" href="#pbk-delete" title="delete">delete</a> commands.
      </p><p>
        For details on configuring retention policy, see the section
        <a class="link" href="#pbk-configuring-retention-policy" title="Configuring Retention Policy">Configuring
        Retention Policy</a>.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--retention-redundancy=<em class="replaceable"><code>redundancy</code></em></code>, </span><span class="term"><code class="option"></code></span></dt><dd><p>
        Specifies the number of full backup copies to keep in the data
        directory. Must be a non-negative integer. The zero value disables
        this setting.
      </p><p>
       Default: <code class="literal">0</code>
      </p></dd><dt><span class="term"><code class="option">--retention-window=<em class="replaceable"><code>window</code></em></code>, </span><span class="term"><code class="option"></code></span></dt><dd><p>
        Number of days of recoverability. Must be a non-negative integer.
        The zero value disables this setting.
      </p><p>
       Default: <code class="literal">0</code>
      </p></dd><dt><span class="term"><code class="option">--wal-depth=<em class="replaceable"><code>wal_depth</code></em></code></span></dt><dd><p>
        Number of latest valid backups on every timeline that must
        retain the ability to perform PITR. Must be a non-negative
        integer. The zero value disables this setting.
      </p><p>
       Default: <code class="literal">0</code>
      </p></dd><dt><span class="term"><code class="option">--delete-wal</code></span></dt><dd><p>
        Deletes WAL files that are no longer required to restore the
        cluster from any of the existing backups.
      </p></dd><dt><span class="term"><code class="option">--delete-expired</code></span></dt><dd><p>
        Deletes backups that do not conform to the retention policy
        defined in the <code class="filename">pg_probackup.conf</code> configuration file.
      </p></dd><dt><span class="term"><code class="option">--merge-expired</code>, </span><span class="term"><code class="option"></code></span></dt><dd><p>
        Merges the oldest incremental backup that satisfies the
        requirements of retention policy with its parent backups that
        have already expired.
      </p></dd><dt><span class="term"><code class="option">--dry-run</code></span></dt><dd><p>
        Displays the current status of all the available backups,
        without deleting or merging expired backups, if any.
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-pinning-options"></a><h4>Pinning Options</h4><p>
          You can use these options together with
          <a class="xref" href="#pbk-backup" title="backup">backup</a> and
          <a class="xref" href="#pbk-set-backup" title="set-backup">set-backup</a> commands.
        </p><p>
          For details on backup pinning, see the section
          <a class="link" href="#pbk-backup-pinning" title="Pinning Backups">Backup Pinning</a>.
        </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--ttl=<em class="replaceable"><code>ttl</code></em></code></span></dt><dd><p>
          Specifies the amount of time the backup should be pinned.
          Must be a non-negative integer. The zero value unpins the already
          pinned backup. Supported units: ms, s, min, h, d (s by
          default).
      </p><p>
       Example: <code class="literal">--ttl=30d</code>
      </p></dd><dt><span class="term"><code class="option">--expire-time=<em class="replaceable"><code>time</code></em></code></span></dt><dd><p>
          Specifies the timestamp up to which the backup will stay
          pinned. Must be an ISO-8601 complaint timestamp.
      </p><p>
       Example: <code class="literal">--expire-time='2020-01-01 00:00:00+03'</code>
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-logging-opts"></a><h4>Logging Options</h4><p>
        You can use these options with any command.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--log-level-console=<em class="replaceable"><code>log_level</code></em></code></span></dt><dd><p>
        Controls which message levels are sent to the console log.
        Valid values are <code class="literal">verbose</code>,
        <code class="literal">log</code>, <code class="literal">info</code>,
        <code class="literal">warning</code>, <code class="literal">error</code> and
        <code class="literal">off</code>. Each level includes all the levels
        that follow it. The later the level, the fewer messages are
        sent. The <code class="literal">off</code> level disables console
        logging.
      </p><p>
       Default: <code class="literal">info</code>
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          All console log messages are going to <code class="systemitem">stderr</code>, so
          the output of <a class="xref" href="#pbk-show" title="show">show</a> and
          <a class="xref" href="#pbk-show-config" title="show-config">show-config</a> commands does
          not mingle with log messages.
        </p></div></dd><dt><span class="term"><code class="option">--log-level-file=<em class="replaceable"><code>log_level</code></em></code></span></dt><dd><p>
        Controls which message levels are sent to a log file. Valid
        values are <code class="literal">verbose</code>, <code class="literal">log</code>,
        <code class="literal">info</code>, <code class="literal">warning</code>,
        <code class="literal">error</code>, and <code class="literal">off</code>. Each
        level includes all the levels that follow it. The later the
        level, the fewer messages are sent. The <code class="literal">off</code>
        level disables file logging.
      </p><p>
       Default: <code class="literal">off</code>
      </p></dd><dt><span class="term"><code class="option">--log-filename=<em class="replaceable"><code>log_filename</code></em></code></span></dt><dd><p>
        Defines the filenames of the created log files. The filenames
        are treated as a <code class="function">strftime</code> pattern, so you can use %-escapes to
        specify time-varying filenames.
      </p><p>
       Default: <code class="filename">pg_probackup.log</code>
      </p><p>
        For example, if you specify the <code class="literal">pg_probackup-%u.log</code> pattern,
        <span class="application">pg_probackup</span> generates a separate log file for each day of the
        week, with <code class="literal">%u</code> replaced by the corresponding decimal number:
        <code class="filename">pg_probackup-1.log</code> for Monday, <code class="filename">pg_probackup-2.log</code> for Tuesday,
        and so on.
      </p><p>
        This option takes effect if file logging is enabled by the
        <code class="option">--log-level-file</code> option.
      </p></dd><dt><span class="term"><code class="option">--error-log-filename=<em class="replaceable"><code>error_log_filename</code></em></code></span></dt><dd><p>
        Defines the filenames of log files for error messages only.
        The filenames are treated as a <code class="function">strftime</code> pattern, so you can
        use %-escapes to specify time-varying filenames.
      </p><p>
       Default: none
      </p><p>
        For example, if you specify the <code class="filename">error-pg_probackup-%u.log</code>
        pattern, <span class="application">pg_probackup</span> generates a separate log file for each
        day of the week, with <code class="literal">%u</code> replaced by the corresponding decimal
        number: <code class="filename">error-pg_probackup-1.log</code> for Monday,
        <code class="filename">error-pg_probackup-2.log</code> for Tuesday, and so on.
      </p><p>
        This option is useful for troubleshooting and monitoring.
      </p></dd><dt><span class="term"><code class="option">--log-directory=<em class="replaceable"><code>log_directory</code></em></code></span></dt><dd><p>
        Defines the directory in which log files will be created. You
        must specify the absolute path. This directory is created
        lazily, when the first log message is written.
      </p><p>
       Default: <code class="filename">$BACKUP_PATH/log/</code>
      </p></dd><dt><span class="term"><code class="option">--log-rotation-size=<em class="replaceable"><code>log_rotation_size</code></em></code></span></dt><dd><p>
        Maximum size of an individual log file. If this value is
        reached, the log file is rotated once a <span class="application">pg_probackup</span> command
        is launched, except <span class="command"><strong>help</strong></span> and <span class="command"><strong>version</strong></span> commands. The zero value
        disables size-based rotation. Supported units: kB, MB, GB, TB
        (kB by default).
      </p><p>
       Default: <code class="literal">0</code>
      </p></dd><dt><span class="term"><code class="option">--log-rotation-age=<em class="replaceable"><code>log_rotation_age</code></em></code></span></dt><dd><p>
        Maximum lifetime of an individual log file. If this value is
        reached, the log file is rotated once a <span class="application">pg_probackup</span> command
        is launched, except <span class="command"><strong>help</strong></span> and <span class="command"><strong>version</strong></span> commands. The time of the
        last log file creation is stored in
        <code class="filename">$BACKUP_PATH/log/log_rotation</code>. The zero value disables
        time-based rotation. Supported units: ms, s, min, h, d (min by
        default).
      </p><p>
       Default: <code class="literal">0</code>
      </p></dd></dl></div><p>
     </p></div><div class="refsect3"><a id="pbk-connection-opts"></a><h4>Connection Options</h4><p>
        You can use these options together with
        <a class="xref" href="#pbk-backup" title="backup">backup</a> and
        <a class="xref" href="#pbk-checkdb" title="checkdb">checkdb</a> commands.
      </p><p>
        All
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/libpq-envars.html" target="_top">libpq
        environment variables</a> are supported.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-d <em class="replaceable"><code>dbname</code></em></code>, </span><span class="term"><code class="option">--pgdatabase=<em class="replaceable"><code>dbname</code></em></code>, </span><span class="term"><code class="envar">PGDATABASE</code></span></dt><dd><p>
        Specifies the name of the database to connect to. The
        connection is used only for managing backup process, so you
        can connect to any existing database. If this option is not
        provided on the command line, <code class="envar">PGDATABASE</code> environment variable,
        or the <code class="filename">pg_probackup.conf</code> configuration file, <span class="application">pg_probackup</span>
        tries to take this value from the <code class="envar">PGUSER</code> environment variable,
        or from the current user name if <code class="envar">PGUSER</code> variable is not set.
      </p></dd><dt><span class="term"><code class="option">-h <em class="replaceable"><code>host</code></em></code>, </span><span class="term"><code class="option">--pghost=<em class="replaceable"><code>host</code></em></code>, </span><span class="term"><code class="envar">PGHOST</code></span></dt><dd><p>
        Specifies the host name of the system on which the server is
        running. If the value begins with a slash, it is used as a
        directory for the Unix domain socket.
      </p><p>
       Default: <code class="literal">localhost</code>
      </p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>port</code></em></code>, </span><span class="term"><code class="option">--pgport=<em class="replaceable"><code>port</code></em></code>, </span><span class="term"><code class="envar">PGPORT</code></span></dt><dd><p>
        Specifies the TCP port or the local Unix domain socket file
        extension on which the server is listening for connections.
      </p><p>
       Default: <code class="literal">5432</code>
      </p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>username</code></em></code>, </span><span class="term"><code class="option">--pguser=<em class="replaceable"><code>username</code></em></code>, </span><span class="term"><code class="envar">PGUSER</code></span></dt><dd><p>
        User name to connect as.
      </p></dd><dt><span class="term"><code class="option">-w</code>, </span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>
        Disables a password prompt. If the server requires password
        authentication and a password is not available by other means
        such as a
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/libpq-pgpass.html" target="_top">.pgpass</a>
        file or <code class="envar">PGPASSWORD</code> environment variable, the connection
        attempt will fail. This flag can be useful in batch jobs and
        scripts where no user is present to enter a password.
      </p></dd><dt><span class="term"><code class="option">-W</code>, </span><span class="term"><code class="option">--password</code></span></dt><dd><p>
        Forces a password prompt. (Deprecated)
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-compression-opts"></a><h4>Compression Options</h4><p>
        You can use these options together with
        <a class="xref" href="#pbk-backup" title="backup">backup</a> and
        <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> commands.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--compress-algorithm=<em class="replaceable"><code>compression_algorithm</code></em></code></span></dt><dd><p>
        Defines the algorithm to use for compressing data files.
        Possible values are <code class="literal">zlib</code>,
        <code class="literal">pglz</code>, and <code class="literal">none</code>. If set
        to <code class="literal">zlib</code> or <code class="literal">pglz</code>, this option enables compression. By default,
        compression is disabled. For the
        <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> command, the
        <code class="literal">pglz</code> compression algorithm is not supported.
      </p><p>
       Default: <code class="literal">none</code>
      </p></dd><dt><span class="term"><code class="option">--compress-level=<em class="replaceable"><code>compression_level</code></em></code></span></dt><dd><p>
        Defines compression level (0 through 9, 0 being no compression
        and 9 being best compression). This option can be used
        together with the <code class="option">--compress-algorithm</code> option.
      </p><p>
       Default: <code class="literal">1</code>
      </p></dd><dt><span class="term"><code class="option">--compress</code></span></dt><dd><p>
        Alias for <code class="literal">--compress-algorithm=zlib</code> and
        <code class="literal">--compress-level=1</code>.
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-archiving-options"></a><h4>Archiving Options</h4><p>
        These options can be used with the
        <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> command in the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/runtime-config-wal.html#GUC-ARCHIVE-COMMAND" target="_top">archive_command</a>
        setting and the <a class="xref" href="#pbk-archive-get" title="archive-get">archive-get</a>
        command in the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/archive-recovery-settings.html#RESTORE-COMMAND" target="_top">restore_command</a>
        setting.
      </p><p>
        Additionally, <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote mode
        options</a> and <a class="link" href="#pbk-logging-opts" title="Logging Options">logging
        options</a> can be used.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--wal-file-path=<em class="replaceable"><code>wal_file_path</code></em></code></span></dt><dd><p>
        Provides the path to the WAL file in
        <em class="parameter"><code>archive_command</code></em> and
        <em class="parameter"><code>restore_command</code></em>. Use the <code class="literal">%p</code>
        variable as the value for this option for correct processing.
      </p></dd><dt><span class="term"><code class="option">--wal-file-name=<em class="replaceable"><code>wal_file_name</code></em></code></span></dt><dd><p>
        Provides the name of the WAL file in
        <em class="parameter"><code>archive_command</code></em> and
        <em class="parameter"><code>restore_command</code></em>. Use the <code class="literal">%f</code>
        variable as the value for this option for correct processing.
      </p></dd><dt><span class="term"><code class="option">--overwrite</code></span></dt><dd><p>
        Overwrites archived WAL file. Use this flag together with the
        <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> command if
        the specified subdirectory of the backup catalog already
        contains this WAL file and it needs to be replaced with its
        newer copy. Otherwise, <span class="command"><strong>archive-push</strong></span> reports that a WAL segment
        already exists, and aborts the operation. If the file to
        replace has not changed, <span class="command"><strong>archive-push</strong></span> skips this file
        regardless of the <code class="option">--overwrite</code> flag.
      </p></dd><dt><span class="term"><code class="option">--batch-size=<em class="replaceable"><code>batch_size</code></em></code></span></dt><dd><p>
        Sets the maximum number of files that can be copied into the archive
        by a single <span class="command"><strong>archive-push</strong></span> process, or from
        the archive by a single <span class="command"><strong>archive-get</strong></span> process.
      </p></dd><dt><span class="term"><code class="option">--archive-timeout=<em class="replaceable"><code>wait_time</code></em></code></span></dt><dd><p>
        Sets the timeout for considering existing <code class="literal">.part</code>
        files to be stale. By default, <span class="application">pg_probackup</span>
        waits 300 seconds.
        This option can be used only with <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> command.
      </p></dd><dt><span class="term"><code class="option">--no-ready-rename</code></span></dt><dd><p>
        Do not rename status files in the <code class="literal">archive_status</code> directory.
        This option should be used only if <em class="parameter"><code>archive_command</code></em>
        contains multiple commands.
        This option can be used only with <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> command.
      </p></dd><dt><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>
        Do not sync copied WAL files to disk. You can use this flag to speed
        up archiving process. Using this flag can result in WAL archive
        corruption in case of operating system or hardware crash.
        This option can be used only with <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a> command.
      </p></dd><dt><span class="term"><code class="option">--prefetch-dir=<em class="replaceable"><code>path</code></em></code></span></dt><dd><p>
        Directory used to store prefetched WAL segments if <code class="option">--batch-size</code> option is used.
        Directory must be located on the same filesystem and on the same mountpoint the
        <code class="literal">PGDATA/pg_wal</code> is located.
        By default files are stored in <code class="literal">PGDATA/pg_wal/pbk_prefetch</code> directory.
        This option can be used only with <a class="xref" href="#pbk-archive-get" title="archive-get">archive-get</a> command.
      </p></dd><dt><span class="term"><code class="option">--no-validate-wal</code></span></dt><dd><p>
        Do not validate prefetched WAL file before using it.
        Use this option if you want to increase the speed of recovery.
        This option can be used only with <a class="xref" href="#pbk-archive-get" title="archive-get">archive-get</a> command.
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-remote-server-opts"></a><h4>Remote Mode Options</h4><p>
        This section describes the options related to running
        <span class="application">pg_probackup</span> operations remotely via SSH. These options can be
        used with <a class="xref" href="#pbk-add-instance" title="add-instance">add-instance</a>,
        <a class="xref" href="#pbk-set-config" title="set-config">set-config</a>,
        <a class="xref" href="#pbk-backup" title="backup">backup</a>,
        <a class="xref" href="#pbk-restore" title="restore">restore</a>,
        <a class="xref" href="#pbk-archive-push" title="archive-push">archive-push</a>, and
        <a class="xref" href="#pbk-archive-get" title="archive-get">archive-get</a> commands.
      </p><p>
        For details on configuring and using the remote mode,
        see <a class="xref" href="#pbk-configuring-the-remote-mode" title="Configuring the Remote Mode">the section called “Configuring the Remote Mode”</a> and
        <a class="xref" href="#pbk-remote-backup" title="Using pg_probackup in the Remote Mode">the section called “Using <span class="application">pg_probackup</span> in the Remote Mode”</a>.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--remote-proto=<em class="replaceable"><code>proto</code></em></code></span></dt><dd><p>
        Specifies the protocol to use for remote operations. Currently
        only the SSH protocol is supported. Possible values are:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ssh</code> enables the remote mode via
            SSH. This is the default value.
          </p></li><li class="listitem"><p>
            <code class="literal">none</code> explicitly disables the remote
            mode.
          </p></li></ul></div><p>
        You can omit this option if the
        <code class="option">--remote-host</code> option is specified.
      </p></dd><dt><span class="term"><code class="option">--remote-host=<em class="replaceable"><code>destination</code></em></code>, </span><span class="term"><code class="option"></code></span></dt><dd><p>
        Specifies the remote host IP address or hostname to connect
        to.
      </p></dd><dt><span class="term"><code class="option">--remote-port=<em class="replaceable"><code>port</code></em></code></span></dt><dd><p>
        Specifies the remote host port to connect to.
      </p><p>
       Default: <code class="literal">22</code>
      </p></dd><dt><span class="term"><code class="option">--remote-user=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>
        Specifies remote host user for SSH connection. If you omit
        this option, the current user initiating the SSH connection is
        used.
      </p></dd><dt><span class="term"><code class="option">--remote-path=<em class="replaceable"><code>path</code></em></code></span></dt><dd><p>
        Specifies <span class="application">pg_probackup</span> installation directory on the remote
        system.
      </p></dd><dt><span class="term"><code class="option">--ssh-options=<em class="replaceable"><code>ssh_options</code></em></code></span></dt><dd><p>
        Provides a string of SSH command-line options. For example,
        the following options can be used to set <em class="parameter"><code>keep-alive</code></em> for SSH
        connections opened by <span class="application">pg_probackup</span>:
        <code class="literal">--ssh-options='-o ServerAliveCountMax=5 -o ServerAliveInterval=60'</code>.
        For the full list of possible options, see
        <a class="ulink" href="https://man.openbsd.org/ssh_config.5" target="_top">ssh_config
        manual page</a>.
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-remote-wal-archive-options"></a><h4>Remote WAL Archive Options</h4><p>
        This section describes the options used to provide the
        arguments for <a class="link" href="#pbk-remote-server-opts" title="Remote Mode Options">remote mode
        options</a> in
        <a class="xref" href="#pbk-archive-get" title="archive-get">archive-get</a> used in the
        <a class="ulink" href="https://postgrespro.com/docs/postgresql/current/archive-recovery-settings.html#RESTORE-COMMAND" target="_top">restore_command</a>
        command when restoring ARCHIVE backups or performing PITR.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--archive-host=<em class="replaceable"><code>destination</code></em></code></span></dt><dd><p>
        Provides the argument for the <code class="option">--remote-host</code>
        option in the <span class="command"><strong>archive-get</strong></span> command.
      </p></dd><dt><span class="term"><code class="option">--archive-port=<em class="replaceable"><code>port</code></em></code></span></dt><dd><p>
        Provides the argument for the <code class="option">--remote-port</code>
        option in the <span class="command"><strong>archive-get</strong></span> command.
      </p><p>
       Default: <code class="literal">22</code>
      </p></dd><dt><span class="term"><code class="option">--archive-user=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>
        Provides the argument for the <code class="option">--remote-user</code>
        option in the <span class="command"><strong>archive-get</strong></span> command. If you omit
        this option, the user that has started the <span class="productname">PostgreSQL</span> cluster is used.
      </p><p>
       Default: <span class="productname">PostgreSQL</span> user
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-partial-restore-options"></a><h4>Partial Restore Options</h4><p>
        This section describes the options for partial cluster restore.
        These options can be used with the
        <a class="xref" href="#pbk-restore" title="restore">restore</a> command.
      </p><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--db-exclude=<em class="replaceable"><code>dbname</code></em></code></span></dt><dd><p>
        Specifies the name of the database to exclude from restore. All other
        databases in the cluster will be restored as usual, including
        <code class="literal">template0</code> and <code class="literal">template1</code>.
        This option can be specified multiple times for multiple
        databases.
      </p></dd><dt><span class="term"><code class="option">--db-include=<em class="replaceable"><code>dbname</code></em></code></span></dt><dd><p>
        Specifies the name of the database to restore from a backup. All other
        databases in the cluster will not be restored, with the exception
        of <code class="literal">template0</code> and
        <code class="literal">template1</code>. This option can be specified
        multiple times for multiple databases.
      </p></dd></dl></div><p>
      </p></div><div class="refsect3"><a id="pbk-replica-options"></a><h4>Replica Options</h4><p>
        This section describes the options related to taking a backup
        from standby.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
          Starting from <span class="application">pg_probackup</span> 2.0.24, backups can be
          taken from standby without connecting to the master server,
          so these options are no longer required. In lower versions,
          <span class="application">pg_probackup</span> had to connect to the master to determine
          recovery time — the earliest moment for which you can
          restore a consistent state of the database cluster.
        </p></div><p>
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--master-db=<em class="replaceable"><code>dbname</code></em></code></span></dt><dd><p>
        Deprecated. Specifies the name of the database on the master
        server to connect to. The connection is used only for managing
        the backup process, so you can connect to any existing
        database. Can be set in the <code class="filename">pg_probackup.conf</code> using the
        <a class="xref" href="#pbk-set-config" title="set-config">set-config</a> command.
      </p><p>
       Default: <code class="literal">postgres</code>, the default <span class="productname">PostgreSQL</span> database
      </p></dd><dt><span class="term"><code class="option">--master-host=<em class="replaceable"><code>host</code></em></code></span></dt><dd><p>
        Deprecated. Specifies the host name of the system on which the
        master server is running.
      </p></dd><dt><span class="term"><code class="option">--master-port=<em class="replaceable"><code>port</code></em></code></span></dt><dd><p>
        Deprecated. Specifies the TCP port or the local Unix domain
        socket file extension on which the master server is listening
        for connections.
      </p><p>
       Default: <code class="literal">5432</code>, the <span class="productname">PostgreSQL</span> default port
      </p></dd><dt><span class="term"><code class="option">--master-user=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>
        Deprecated. User name to connect as.
      </p><p>
       Default: <code class="literal">postgres</code>,
       the <span class="productname">PostgreSQL</span> default user name
      </p></dd><dt><span class="term"><code class="option">--replica-timeout=<em class="replaceable"><code>timeout</code></em></code>, </span><span class="term"><code class="option"></code></span></dt><dd><p>
        Deprecated. Wait time for WAL segment streaming via
        replication, in seconds. By default, <span class="application">pg_probackup</span> waits 300
        seconds. You can also define this parameter in the
        <code class="filename">pg_probackup.conf</code> configuration file using the
        <a class="xref" href="#pbk-set-config" title="set-config">set-config</a> command.
      </p><p>
       Default: <code class="literal">300 sec</code>
      </p></dd></dl></div><p>
      </p></div></div></div><div class="refsect1"><a id="pbk-howto"></a><h2>How-To</h2><p>
      All examples below assume the remote mode of operations via
      SSH. If you are planning to run backup and
      restore operation locally, skip the
      <span class="quote">“<span class="quote">Setup passwordless SSH connection</span>”</span> step
      and omit all <code class="option">--remote-*</code> options.
    </p><p>
      Examples are based on <span class="productname">Ubuntu</span> 18.04,
      <span class="productname">PostgreSQL</span> 11, and <span class="application">pg_probackup</span>
      2.2.0.
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">backup</code> — <span class="productname">PostgreSQL</span>
          role used for connection to <span class="productname">PostgreSQL</span>
          cluster.
        </p></li><li class="listitem"><p>
          <code class="literal">backupdb</code> — database used for connection
          to <span class="productname">PostgreSQL</span> cluster.
        </p></li><li class="listitem"><p>
          <code class="literal">backup_host</code> — host with backup catalog.
        </p></li><li class="listitem"><p>
          <code class="literal">backupman</code> — user on
          <code class="literal">backup_host</code> running all <span class="application">pg_probackup</span>
          operations.
        </p></li><li class="listitem"><p>
          <code class="filename">/mnt/backups</code> — directory on
          <code class="literal">backup_host</code> where backup catalog is stored.
        </p></li><li class="listitem"><p>
          <code class="literal">postgres_host</code> — host with <span class="productname">PostgreSQL</span>
          cluster.
        </p></li><li class="listitem"><p>
          <code class="literal">postgres</code> — user on
          <code class="literal">postgres_host</code> that has started the <span class="productname">PostgreSQL</span> cluster.
        </p></li><li class="listitem"><p>
          <code class="filename">/var/lib/postgresql/11/main</code> — <span class="productname">PostgreSQL</span>
          data directory on <code class="literal">postgres_host</code>.
        </p></li></ul></div><div class="refsect2"><a id="pbk-minimal-setup"></a><h3>Minimal Setup</h3><p>
        This scenario illustrates setting up standalone FULL and DELTA backups.
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><a id="pbk-setup-passwordless-ssh-connection-from-backup-host-to-postgres-host"></a><p class="title"><strong>Set up passwordless SSH connection from
        <code class="literal">backup_host</code> to
        <code class="literal">postgres_host</code>:</strong></p><pre class="programlisting">
[backupman@backup_host] ssh-copy-id postgres@postgres_host
</pre></li><li class="step"><a id="pbk-setup-postgresql-cluster"></a><p class="title"><strong>Configure your <span class="productname">PostgreSQL</span> cluster.</strong></p><p>
          For security purposes, it is recommended to use a separate
          database for backup operations.
        </p><pre class="programlisting">
postgres=#
CREATE DATABASE backupdb;
</pre><p>
          Connect to the <code class="literal">backupdb</code> database, create the
          <code class="literal">probackup</code> role, and grant the following
          permissions to this role:
        </p><pre class="programlisting">
backupdb=#
BEGIN;
CREATE ROLE backup WITH LOGIN REPLICATION;
GRANT USAGE ON SCHEMA pg_catalog TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.current_setting(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_is_in_recovery() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_start_backup(text, boolean, boolean) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_stop_backup(boolean, boolean) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_create_restore_point(text) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_switch_wal() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_last_wal_replay_lsn() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_current_snapshot() TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.txid_snapshot_xmax(txid_snapshot) TO backup;
GRANT EXECUTE ON FUNCTION pg_catalog.pg_control_checkpoint() TO backup;
COMMIT;
</pre></li><li class="step"><a id="pbk-init-the-backup-catalog"></a><p class="title"><strong>Initialize the backup catalog:</strong></p><pre class="programlisting">
[backupman@backup_host]$ pg_probackup-11 init -B /mnt/backups
INFO: Backup catalog '/mnt/backups' successfully inited
</pre></li><li class="step"><a id="pbk-add-instance-pg-11-to-backup-catalog"></a><p class="title"><strong>Add instance <code class="literal">pg-11</code> to the backup catalog:</strong></p><pre class="programlisting">
[backupman@backup_host]$ pg_probackup-11 add-instance -B /mnt/backups --instance 'pg-11' --remote-host=postgres_host --remote-user=postgres -D /var/lib/postgresql/11/main
INFO: Instance 'node' successfully inited
</pre></li><li class="step"><a id="pbk-take-full-backup"></a><p class="title"><strong>Take a FULL backup:</strong></p><pre class="programlisting">
[backupman@backup_host] pg_probackup-11 backup -B /mnt/backups --instance 'pg-11' -b FULL --stream --remote-host=postgres_host --remote-user=postgres -U backup -d backupdb
INFO: Backup start, pg_probackup version: 2.2.0, instance: node, backup ID: PZ7YK2, backup mode: FULL, wal mode: STREAM, remote: true, compress-algorithm: none, compress-level: 1
INFO: Start transferring data files
INFO: Data files are transferred
INFO: wait for pg_stop_backup()
INFO: pg_stop backup() successfully executed
INFO: Validating backup PZ7YK2
INFO: Backup PZ7YK2 data files are valid
INFO: Backup PZ7YK2 resident size: 196MB
INFO: Backup PZ7YK2 completed
</pre></li><li class="step"><a id="pbk-lets-take-a-look-at-the-backup-catalog"></a><p class="title"><strong>Let's take a look at the backup catalog:</strong></p><pre class="programlisting">
[backupman@backup_host] pg_probackup-11 show -B /mnt/backups --instance 'pg-11'

BACKUP INSTANCE 'pg-11'
==================================================================================================================================
 Instance  Version  ID      Recovery Time           Mode   WAL Mode  TLI  Time   Data   WAL  Zratio  Start LSN  Stop LSN   Status
==================================================================================================================================
 node      11       PZ7YK2  2019-10-11 19:45:45+03  FULL  STREAM    1/0   11s  180MB  16MB    1.00  0/3C000028  0/3C000198  OK
</pre></li><li class="step"><a id="pbk-take-incremental-backup-in-delta-mode"></a><p class="title"><strong>Take an incremental backup in the DELTA mode:</strong></p><pre class="programlisting">
[backupman@backup_host] pg_probackup-11 backup -B /mnt/backups --instance 'pg-11' -b delta --stream --remote-host=postgres_host --remote-user=postgres -U backup -d backupdb
INFO: Backup start, pg_probackup version: 2.2.0, instance: node, backup ID: PZ7YMP, backup mode: DELTA, wal mode: STREAM, remote: true, compress-algorithm: none, compress-level: 1
INFO: Parent backup: PZ7YK2
INFO: Start transferring data files
INFO: Data files are transferred
INFO: wait for pg_stop_backup()
INFO: pg_stop backup() successfully executed
INFO: Validating backup PZ7YMP
INFO: Backup PZ7YMP data files are valid
INFO: Backup PZ7YMP resident size: 32MB
INFO: Backup PZ7YMP completed
</pre></li><li class="step"><a id="pbk-lets-hide-some-parameters-into-config-so-cmdline-can-be-less-crowdy"></a><p class="title"><strong>Let's add some parameters to <span class="application">pg_probackup</span>
        configuration file, so that you can omit them from the command line:</strong></p><pre class="programlisting">
[backupman@backup_host] pg_probackup-11 set-config -B /mnt/backups --instance 'pg-11' --remote-host=postgres_host --remote-user=postgres -U backup -d backupdb
</pre></li><li class="step"><a id="pbk-take-another-incremental-backup-in-delta-mode-omitting-some-of-the-previous-parameters"></a><p class="title"><strong>Take another incremental backup in the DELTA mode, omitting
        some of the previous parameters:</strong></p><pre class="programlisting">
[backupman@backup_host] pg_probackup-11 backup -B /mnt/backups --instance 'pg-11' -b delta --stream
INFO: Backup start, pg_probackup version: 2.2.0, instance: node, backup ID: PZ7YR5, backup mode: DELTA, wal mode: STREAM, remote: true, compress-algorithm: none, compress-level: 1
INFO: Parent backup: PZ7YMP
INFO: Start transferring data files
INFO: Data files are transferred
INFO: wait for pg_stop_backup()
INFO: pg_stop backup() successfully executed
INFO: Validating backup PZ7YR5
INFO: Backup PZ7YR5 data files are valid
INFO: Backup PZ7YR5 resident size: 32MB
INFO: Backup PZ7YR5 completed
</pre></li><li class="step"><a id="pbk-lets-take-a-look-at-instance-config"></a><p class="title"><strong>Let's take a look at the instance configuration:</strong></p><pre class="programlisting">
[backupman@backup_host] pg_probackup-11 show-config -B /mnt/backups --instance 'pg-11'

# Backup instance information
pgdata = /var/lib/postgresql/11/main
system-identifier = 6746586934060931492
xlog-seg-size = 16777216
# Connection parameters
pgdatabase = backupdb
pghost = postgres_host
pguser = backup
# Replica parameters
replica-timeout = 5min
# Archive parameters
archive-timeout = 5min
# Logging parameters
log-level-console = INFO
log-level-file = OFF
log-filename = pg_probackup.log
log-rotation-size = 0
log-rotation-age = 0
# Retention parameters
retention-redundancy = 0
retention-window = 0
wal-depth = 0
# Compression parameters
compress-algorithm = none
compress-level = 1
# Remote access parameters
remote-proto = ssh
remote-host = postgres_host
</pre><p>
          Note that we are getting the default values for other options
          that were not overwritten by the <span class="command"><strong>set-config</strong></span> command.
        </p></li><li class="step"><a id="pbk-lets-take-a-look-at-the-backup-catalog-1"></a><p class="title"><strong>Let's take a look at the backup catalog:</strong></p><pre class="programlisting">
[backupman@backup_host] pg_probackup-11 show -B /mnt/backups --instance 'pg-11'

====================================================================================================================================
 Instance  Version  ID      Recovery Time           Mode   WAL Mode  TLI  Time   Data   WAL  Zratio  Start LSN   Stop LSN    Status
====================================================================================================================================
 node      11       PZ7YR5  2019-10-11 19:49:56+03  DELTA  STREAM    1/1   10s  112kB  32MB    1.00  0/41000028  0/41000160  OK
 node      11       PZ7YMP  2019-10-11 19:47:16+03  DELTA  STREAM    1/1   10s  376kB  32MB    1.00  0/3E000028  0/3F0000B8  OK
 node      11       PZ7YK2  2019-10-11 19:45:45+03  FULL   STREAM    1/0   11s  180MB  16MB    1.00  0/3C000028  0/3C000198  OK
</pre></li></ol></div></div></div><div class="refsect1"><a id="pbk-versioning"></a><h2>Versioning</h2><p>
      <span class="application">pg_probackup</span> follows
      <a class="ulink" href="https://semver.org/" target="_top">semantic</a> versioning.
    </p></div><div class="refsect1"><a id="idm46529704971520"></a><h2>Authors</h2><p>
   Postgres Professional, Moscow, Russia.
  </p><div class="refsect2"><a id="idm46529704970400"></a><h3>Credits</h3><p>
    <span class="application">pg_probackup</span> utility is based on <span class="application">pg_arman</span>,
    which was originally written by NTT and then developed and maintained by Michael Paquier.
  </p></div></div></div></div></div></body></html>